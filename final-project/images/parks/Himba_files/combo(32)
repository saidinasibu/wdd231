YUI.add("hermes-template-photo-list-photo",(function(n,t){var e=n.Template.Handlebars.revive({1:function(n,t,e,o,l){var r,a,i=null!=t?t:n.nullContext||{},c=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t<div class="photo-list-photo-container">\n\t\t<img loading="lazy" src="'+n.escapeExpression("function"==typeof(a=null!=(a=c(e,"photoUrl")||(null!=t?c(t,"photoUrl"):t))?a:n.hooks.helperMissing)?a.call(i,{name:"photoUrl",hash:{},data:l,loc:{start:{line:3,column:27},end:{line:3,column:39}}}):a)+'" height="100%" width="100%">\n'+(null!=(r=c(e,"if").call(i,null!=t?c(t,"isVideo"):t,{name:"if",hash:{},fn:n.program(2,l,0),inverse:n.noop,data:l,loc:{start:{line:4,column:2},end:{line:6,column:9}}}))?r:"")+"\n"+(null!=(r=c(e,"if").call(i,null!=t?c(t,"hasInteraction"):t,{name:"if",hash:{},fn:n.program(4,l,0),inverse:n.program(7,l,0),data:l,loc:{start:{line:8,column:2},end:{line:15,column:9}}}))?r:"")+"\t</div>\n"},2:function(n,t,e,o,l){var r,a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(r=n.invokePartial(a(o,"photo-card-overlay-icon"),t,{name:"photo-card-overlay-icon",hash:{type:"video"},data:l,indent:"\t\t\t",helpers:e,partials:o,decorators:n.decorators}))?r:""},4:function(n,t,e,o,l){var r,a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return(null!=(r=a(e,"if").call(null!=t?t:n.nullContext||{},null!=t?a(t,"showInteractionBarPlaceholder"):t,{name:"if",hash:{},fn:n.program(5,l,0),inverse:n.noop,data:l,loc:{start:{line:9,column:3},end:{line:11,column:10}}}))?r:"")+'\t\t\t<div class="interaction-view"></div>\n'},5:function(n,t,e,o,l){return'\t\t\t\t<div class="interaction-view-placeholder"></div>\n'},7:function(n,t,e,o,l){var r,a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t<a class="click-target" href="'+n.escapeExpression("function"==typeof(r=null!=(r=a(e,"photoPageUrl")||(null!=t?a(t,"photoPageUrl"):t))?r:n.hooks.helperMissing)?r.call(null!=t?t:n.nullContext||{},{name:"photoPageUrl",hash:{},data:l,loc:{start:{line:14,column:33},end:{line:14,column:49}}}):r)+'" tabindex="0" role="heading" aria-level="3"></a>\n'},9:function(n,t,e,o,l){var r,a=null!=t?t:n.nullContext||{},i=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return(null!=(r=i(e,"if").call(a,null!=t?i(t,"isVideo"):t,{name:"if",hash:{},fn:n.program(10,l,0),inverse:n.noop,data:l,loc:{start:{line:18,column:1},end:{line:20,column:8}}}))?r:"")+"\n"+(null!=(r=i(e,"if").call(a,null!=t?i(t,"hasInteraction"):t,{name:"if",hash:{},fn:n.program(12,l,0),inverse:n.program(15,l,0),data:l,loc:{start:{line:22,column:1},end:{line:29,column:8}}}))?r:"")},10:function(n,t,e,o,l){var r,a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(r=n.invokePartial(a(o,"photo-card-overlay-icon"),t,{name:"photo-card-overlay-icon",hash:{type:"video"},data:l,indent:"\t\t",helpers:e,partials:o,decorators:n.decorators}))?r:""},12:function(n,t,e,o,l){var r,a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return(null!=(r=a(e,"if").call(null!=t?t:n.nullContext||{},null!=t?a(t,"showInteractionBarPlaceholder"):t,{name:"if",hash:{},fn:n.program(13,l,0),inverse:n.noop,data:l,loc:{start:{line:23,column:2},end:{line:25,column:9}}}))?r:"")+'\t\t<div class="interaction-view"></div>\n'},13:function(n,t,e,o,l){return'\t\t\t<div class="interaction-view-placeholder"></div>\n'},15:function(n,t,e,o,l){var r,a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t<a class="click-target" href="'+n.escapeExpression("function"==typeof(r=null!=(r=a(e,"photoPageUrl")||(null!=t?a(t,"photoPageUrl"):t))?r:n.hooks.helperMissing)?r.call(null!=t?t:n.nullContext||{},{name:"photoPageUrl",hash:{},data:l,loc:{start:{line:28,column:32},end:{line:28,column:48}}}):r)+'" tabindex="0" role="heading" aria-level="3"></a>\n'},compiler:[8,">= 4.3.0"],main:function(n,t,e,o,l){var r,a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(r=a(e,"if").call(null!=t?t:n.nullContext||{},null!=t?a(t,"allowLazyLoading"):t,{name:"if",hash:{},fn:n.program(1,l,0),inverse:n.program(9,l,0),data:l,loc:{start:{line:1,column:0},end:{line:30,column:7}}}))?r:""},usePartial:!0,useData:!0}),o={};n.Array.each(["photo-card-overlay-icon","photo-card-overlay-icon"],(function(t){var e=n.Template.get("hermes/"+t);e&&(o[t]=e)})),n.Template.register("hermes/photo-list-photo",(function(t,l){return(l=l||{}).partials=l.partials?n.merge(o,l.partials):o,e(t,l)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-photo-card-overlay-icon","hermes-template-photo-card-overlay-icon"]});YUI.add("photo-list-photo-view",(function(e){var t=require("hermes-core/type-validator");e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.set("isZombie",!YUI.Env.isServer&&e.requiredToShowOnServer&&this.get("layoutItem")&&!this.get("layoutItem").isAwake),this.onlyShowCurateForOwner=e.onlyShowCurateForOwner,this.allowLazyLoading=e.allowLazyLoading,this},loadState:function(){var t=e.URLHelper.getPhotoPage({photoId:this.get("model").getValue("id"),pathAlias:this.get("model").getValue("owner").getValue("pathAlias"),contextSuffix:this.get("contextSuffix")});return this.set("photoPageUrl",t),e.Promise.resolve()},buildContainer:function(){var t,i=this.get("container"),n=this.get("layoutItem");if(n.isAwake)this.updateGeometry(),this.setContainerHTML(this.render()),YUI.Env.isServer?(this.allowLazyLoading||i.setStyles({"background-image":"url("+this.get("photoUrl")+")"}),i.addClass("awake"),this.get("model").getValue("needsInterstitial")&&i.addClass("restricted-image")):(this.allowLazyLoading||this.get("showLowResImageFirst")&&i.setStyles({backgroundImage:"url("+this.get("model").getValue("sizes").sq.url+")"}).addClass("low-res"),this.downloadCacheAndSetImage());else if(YUI.Env.isServer)this.set("isZombie",!0);else if(!YUI.Env.isServer||this.get("isZombie")){var a="";t=e.Node.create(this.get("placeHolderHTML")).set("innerHTML",this.render()),this.get("model").getValue("needsInterstitial")&&(a=" restricted-image"),t.setAttrs({id:i.getAttribute("id"),className:i.getAttribute("class")+a}),this.updateNodeGeometry(n,t),this.serialize(t),this.set("isReallySleeping",!0),this.set("isZombie",!1),this.downloadCacheAndSetImage()}return this.get("model").getValue("isVideo")&&this.get("container").addClass("is-video"),this.get("showInteractionBarPlaceholder")&&(this.get("model").getValue("aspectRatio")>1?i.addClass("landscape"):i.addClass("portrait")),this},activate:function(){var e;return this.renderInteractionView().then(function(e){this.fire("activated")}.bind(this)),this.get("showLowResImageFirst")&&((e=this.get("parentContainer").getDOMNode()).addEventListener("transitionend",this.removeTransition),e.addEventListener("webkitTransitionEnd",this.removeTransition)),this.get("interactionContainer")&&this.registerEventHandler(this.get("interactionContainer").delegate(["blur","focus"],this.toggleKeyboardFocusStyling.bind(this),"a, .engagement-item")),this},toggleKeyboardFocusStyling:function(e){var t=e.target.ancestor(".interaction-view");t&&t.toggleClass("has-keyboard-focus","focus"===e.type)},setHoverVisible:function(e){var t=this.get("interactionContainer");t&&(e?t.addClass("manual-hover"):t.removeClass("manual-hover"))},render:function(){return this.templates("photo-list-photo")({photoPageUrl:this.get("photoPageUrl"),hasInteraction:!!this.get("interactionViewName")&&!this.appContext.forceServerRender,showInteractionBarPlaceholder:this.get("showInteractionBarPlaceholder"),isVideo:this.get("model").getValue("isVideo"),photoUrl:this.get("model").getValue("needsInterstitial")?e.config.flickr.urls.assetRoot+"/images/photo-fuzzy-t.png":this.get("photoUrl"),allowLazyLoading:this.allowLazyLoading})},removeTransition:function(e){e&&e.target&&e.target.classList&&e.target.classList.contains("photo-list-photo-view")&&e.target.classList.remove("low-res")},downloadCacheAndSetImage:function(){this.allowLazyLoading?this.handleImageLoad(!0,this.get("photoUrl")):e.fluid.loadImage(this.get("photoUrl"),{timeout:1e3,retry:!0}).then(function(e){this.handleImageLoad(!0,e)}.bind(this),function(e){this.handleImageLoad(!1,e+"?retry="+Date.now())}.bind(this))},handleImageLoad:function(t,i){var n,a=this,r=this.get("isReallySleeping");n=r?this.deserialize():this.get("container"),this.allowLazyLoading||n.setStyle("backgroundImage","url("+i+")"),t||n.setStyle("backgroundColor","#eee"),this.get("model").getValue("needsInterstitial")&&n.addClass("restricted-image"),r?this.serialize(n):e.fluid.chill((function(){var e,i=this.get("container");r||(i.addClass("awake"),setTimeout((function(){(e=a.get("interactionView"))&&e.updateBreakpoints&&e.updateBreakpoints()}),0),this.fire(t?"loaded":"loadError"))}),this),n=null},updateGeometry:function(e){var t,i=this.get("isReallySleeping");e?this.set("layoutItem",e):e=this.get("layoutItem"),t=i?this.deserialize():this.get("container"),this.updateNodeGeometry(e,t),i&&this.serialize(t),t=null},updateNodeGeometry:function(t,i){YUI.Env.isServer?i.setStyles({transform:"translate("+t.geometry.left+"px, "+t.geometry.top+"px)","-webkit-transform":"translate("+t.geometry.left+"px, "+t.geometry.top+"px)","-ms-transform":"translate("+t.geometry.left+"px, "+t.geometry.top+"px)"}):e.fluid.setStylePrefixed("transform","translate("+t.geometry.left+"px, "+t.geometry.top+"px)",i),i.setStyles({width:t.geometry.width+"px",height:t.geometry.height+"px"}),t.forcedAspectRatio?i.addClass("forced-aspect-ratio"):i.removeClass("forced-aspect-ratio")},sleep:function(){var t,i;this.get("isReallySleeping")||(YUI.Env.isServer?this.set("isZombie",!0):(this.get("id"),this.destroyInteractionView(),(i=this.get("container")).removeClass("awake"),this.serialize(i),t=e.Node.create(this.get("placeHolderHTML")),this.get("parentContainer").replaceChild(t,i),this.set("container",t),this.set("isReallySleeping",!0),this.set("isZombie",!1),i=null))},wake:function(){var t,i,n,a=this;this.get("isReallySleeping")&&(this.get("id"),t=this.get("container"),i=this.get("parentContainer"),n=this.deserialize(),i.replaceChild(n,t),this.set("container",n),this.set("isReallySleeping",!1),this.renderInteractionView(),e.fluid.chill((function(){var e;this.get("container").addClass("awake"),setTimeout((function(){(e=a.get("interactionView"))&&e.updateBreakpoints&&e.updateBreakpoints()}),0)}),this),t=null)},isAwake:function(){return!this.get("isReallySleeping")},serialize:function(t){if(YUI.Env.isServer)throw new Error("Impossible to `serialize` on the server (uses sessionStorage). Maybe you meant to call `sleep`?");t&&e.Storage.Instance.set(this.get("storageId"),t.getDOMNode().outerHTML)},deserialize:function(){if(YUI.Env.isServer)throw new Error("Impossible to `deserialize` on the server (uses sessionStorage). Maybe you meant to call `wake`?");var t,i=e.Storage.Instance.get(this.get("storageId"));return i&&(t=e.Node.create(i),this.dematerialize()),t},dematerialize:function(){if(YUI.Env.isServer)throw new Error("Impossible to `dematerialize` on the server (uses sessionStorage).");e.Storage.Instance.remove(this.get("storageId"))},renderInteractionView:function(){var t,i,n=this,a=this.get("interactionViewName"),r=this.get("interactionView");if(a&&!r)return i=this.onlyShowCurateForOwner?this.get("model").getValue("isOwner"):void 0,this.appContext.getView(a,e.merge(this._params,{id:this.get("id"),container:this.get("interactionContainer"),model:this.get("model"),listModelParams:this.get("listModelParams"),photoPageUrl:this.get("photoPageUrl"),isActiveViewAgnostic:this.get("isActiveViewAgnostic"),engagementModelName:this.get("engagementModelName"),layoutWidth:this.get("layoutItem").geometry.width,showCurate:i})).then(function(e){return this.set("interactionView",e),this.registerEventHandler(this.get("interactionView").on("hoverActionOpened",this.setHoverVisible.bind(this,!0))),this.registerEventHandler(this.get("interactionView").on("hoverActionClosed",this.setHoverVisible.bind(this,!1))),e.initialize()}.bind(this)).then((function(e){return setTimeout((function(){n.isAwake()&&e&&e.updateBreakpoints&&e.updateBreakpoints()}),0),e}));if(r){if(!r.get("container").inDoc()){(t=r.get("container")).addClass("interaction-view"),this.get("interactionContainer")||this.buildContainer();try{this.get("container").replaceChild(t,this.get("interactionContainer"))}catch(e){console.log("replaceChild failed"),console.log("---"),console.log("caught exception:",e),console.log("---"),console.log("container:",this.get("container")),console.log("node to insert:",t),console.log("node to remove:",this.get("interactionContainer")),console.log("---"),console.log("node to remove in dom:",this.get("interactionContainer").inDoc()),console.log("node to remove ancestors:",this.get("interactionContainer").ancestors("*",!1))}r.normalizedActivate(),setTimeout((function(){r&&r.updateBreakpoints&&r.updateBreakpoints()}),0)}return e.Promise.resolve(r)}return e.Promise.resolve(null)},destroyInteractionView:function(){var e=this.get("interactionView");e&&(e.destroy(),this.set("interactionView",null))},destructor:function(){this.dematerialize()}},{ATTRS:{id:{writeOnce:"initOnly",validator:function(e,i){return t.photoId(e)}},parentSignature:{writeOnce:"initOnly"},storageId:{readOnly:!0,derivedBy:["id","parentSignature"],getter:function(){return this.get("parentSignature")+"-"+this.get("id")}},layoutItem:{validator:function(e,t){return"object"==typeof e&&e.hasOwnProperty("aspectRatio")&&e.hasOwnProperty("geometry")&&"object"==typeof e.geometry&&e.geometry.hasOwnProperty("width")&&e.geometry.hasOwnProperty("height")&&e.geometry.hasOwnProperty("top")&&e.geometry.hasOwnProperty("left")&&e.hasOwnProperty("isAwake")}},photoUrl:{value:"/images/spaceball.gif",getter:function(e,t){var i,n=this.get("model"),a=this.get("layoutItem"),r={};return this.get("showInteractionBarPlaceholder")?(n.getValue("aspectRatio")>1?r.height=a.geometry.height-(this.get("interactionBarHeight")||0):r.width=a.geometry.width,i=n.getSizeToFit(r,{includeSquare:1===a.aspectRatio})):i=n.getSizeToFit({width:a.geometry.width,height:a.geometry.height},{includeSquare:1===a.aspectRatio}),i.url}},photoPageUrl:{writeOnce:!0,validator:function(t,i){return e.AttributeHelpers.validateString(t)}},model:{value:null},listModelParams:{value:null},parentContainer:{writeOnce:"initOnly"},contextSuffix:{writeOnce:"initOnly",value:null,validator:function(t,i){return e.AttributeHelpers.validateString(t)}},measureAFT:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)}},isReallySleeping:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)}},isZombie:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)}},placeHolderHTML:{value:'<div class="youcansleepwhenyouredead" />',validator:function(t,i){return e.AttributeHelpers.validateString(t)}},showLowResImageFirst:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)}},interactionViewName:{writeOnce:"initOnly",value:null,validator:function(t,i){return e.AttributeHelpers.validateString(t)}},showInteractionBarPlaceholder:{writeOnce:"initOnly",value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)}},interactionBarHeight:{writeOnce:"initOnly",value:null,validator:function(t,i){return e.AttributeHelpers.validateInteger(t)}},engagementModelName:{writeOnce:"initOnly",value:null,validator:function(t,i){return e.AttributeHelpers.validateString(t)}},interactionView:{value:null},interactionContainer:{value:null,getter:function(e,t){return e||YUI.Env.isServer||(e=this.get("container").one(".interaction-view")),e}}}})}),"@VERSION@",{requires:["flickr-view","hermes-template-photo-list-photo","url-helper","attribute-helpers"],optionalRequires:["fluid","storage-helper","hermes-core"],langBundles:["common"]});YUI.add("hermes-template-photo-list-static-item",(function(e,t){var a=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,t,a,i,r){return'<div class="photo-list-static-item-container">\n\t<div>\n\t</div>\n</div>\n'},useData:!0}),i={};e.Array.each([],(function(t){var a=e.Template.get("hermes/"+t);a&&(i[t]=a)})),e.Template.register("hermes/photo-list-static-item",(function(t,r){return(r=r||{}).partials=r.partials?e.merge(i,r.partials):i,a(t,r)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-list-static-item-view",(function(e){e.PhotolistStaticItemView=e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.set("layoutItem",e.layoutItem),this.set("isZombie",!YUI.Env.isServer&&e.requiredToShowOnServer&&this.get("layoutItem")&&!this.get("layoutItem").isAwake),this},loadState:function(){return e.Promise.resolve()},buildContainer:function(){var t,i=this.get("container"),r=this.get("layoutItem");if(r.isAwake)this.updateGeometry(),this.setContainerHTML(this.render());else if(YUI.Env.isServer)this.set("isZombie",!0);else if(!YUI.Env.isServer||this.get("isZombie")){(t=e.Node.create(this.get("placeHolderHTML")).set("innerHTML",this.render())).setAttrs({id:i.getAttribute("id"),className:i.getAttribute("class")+""}),this.updateNodeGeometry(r,t),this.serialize(t),this.set("isReallySleeping",!0),this.set("isZombie",!1)}return this},activate:function(){return this.fire("activated"),this},setHoverVisible:function(e){},render:function(){return!0},removeTransition:function(e){},updateGeometry:function(e){var t,i=this.get("isReallySleeping");e?this.set("layoutItem",e):e=this.get("layoutItem"),t=i?this.deserialize():this.get("container"),this.updateNodeGeometry(e,t),i&&this.serialize(t),t=null},updateNodeGeometry:function(t,i){YUI.Env.isServer?i.setStyles({transform:"translate("+t.geometry.left+"px, "+t.geometry.top+"px)"}):e.fluid.setStylePrefixed("transform","translate("+t.geometry.left+"px, "+t.geometry.top+"px)",i),i.setStyles({width:t.geometry.width+"px",height:t.geometry.height+"px"})},sleep:function(){var t,i;this.get("isReallySleeping")||(YUI.Env.isServer?this.set("isZombie",!0):(this.get("id"),this.destroyInteractionView(),(i=this.get("container")).removeClass("awake"),this.serialize(i),t=e.Node.create(this.get("placeHolderHTML")),this.get("parentContainer").replaceChild(t,i),this.set("container",t),this.set("isReallySleeping",!0),this.set("isZombie",!1),i=null))},wake:function(){var e,t,i;this.get("isReallySleeping")&&(this.get("id"),e=this.get("container"),t=this.get("parentContainer"),i=this.deserialize(),t.replaceChild(i,e),this.set("container",i),this.set("isReallySleeping",!1),e=null)},isAwake:function(){return!this.get("isReallySleeping")},serialize:function(t){if(YUI.Env.isServer)throw new Error("Impossible to `serialize` on the server (uses sessionStorage). Maybe you meant to call `sleep`?");t&&e.Storage.Instance.set(this.get("storageId"),t.getDOMNode().outerHTML)},deserialize:function(){if(YUI.Env.isServer)throw new Error("Impossible to `deserialize` on the server (uses sessionStorage). Maybe you meant to call `wake`?");var t,i=e.Storage.Instance.get(this.get("storageId"));return i&&(t=e.Node.create(i),this.dematerialize()),t},dematerialize:function(){if(YUI.Env.isServer)throw new Error("Impossible to `dematerialize` on the server (uses sessionStorage).");e.Storage.Instance.remove(this.get("storageId"))},renderInteractionView:function(){return e.Promise.resolve(null)},destroyInteractionView:function(){},destructor:function(){this.dematerialize()}},{ATTRS:{id:{},parentSignature:{writeOnce:"initOnly"},storageId:{readOnly:!0,derivedBy:["id","parentSignature"],getter:function(){return this.get("parentSignature")+"-"+this.get("id")}},layoutItem:{},model:{value:null},listModelParams:{value:null},parentContainer:{writeOnce:"initOnly"},contextSuffix:{writeOnce:"initOnly",value:null,validator:function(t,i){return e.AttributeHelpers.validateString(t)}},measureAFT:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)}},isReallySleeping:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)}},isZombie:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)}},placeHolderHTML:{value:'<div class="youcansleepwhenyouredead" />',validator:function(t,i){return e.AttributeHelpers.validateString(t)}},showLowResImageFirst:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)}},interactionViewName:{writeOnce:"initOnly",value:null,validator:function(t,i){return e.AttributeHelpers.validateString(t)}},showInteractionBarPlaceholder:{writeOnce:"initOnly",value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)}},interactionBarHeight:{writeOnce:"initOnly",value:null,validator:function(t,i){return e.AttributeHelpers.validateInteger(t)}},engagementModelName:{writeOnce:"initOnly",value:null,validator:function(t,i){return e.AttributeHelpers.validateString(t)}},interactionView:{value:null},interactionContainer:{value:null,getter:function(e,t){return e||YUI.Env.isServer||(e=this.get("container").one(".interaction-view")),e}}}})}),"@VERSION@",{requires:["flickr-view","hermes-template-prbd-moola-position","hermes-template-photo-list-static-item","url-helper","attribute-helpers"],optionalRequires:["fluid","storage-helper","hermes-core"],langBundles:["common"]});YUI.add("hermes-template-sign-up-dialog",(function(e,n){var l=e.Template.Handlebars.revive({1:function(e,n,l,t,a){return"fixed-width"},compiler:[8,">= 4.3.0"],main:function(e,n,l,t,a){var i,o,s=null!=n?n:e.nullContext||{},r=e.hooks.helperMissing,u=e.escapeExpression,c="function",p=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return u((p(l,"outlet")||n&&p(n,"outlet")||r).call(s,null!=n?p(n,"cta-dialog-view"):n,{name:"outlet",hash:{},data:a,loc:{start:{line:1,column:0},end:{line:1,column:26}}}))+'\n\n<div class="sign-up-content-container">\n\t<div class="dialog-pro-cta">\n\t\t<h3 class="dialog-pro-cta-title">'+u(typeof(o=null!=(o=p(l,"proCTATitle")||(null!=n?p(n,"proCTATitle"):n))?o:r)===c?o.call(s,{name:"proCTATitle",hash:{},data:a,loc:{start:{line:5,column:35},end:{line:5,column:50}}}):o)+"</h3>\n"+(null!=(i=e.invokePartial(p(t,"pro-benefits-list"),n,{name:"pro-benefits-list",hash:{benefits:null!=n?p(n,"benefits"):n},data:a,indent:"\t\t",helpers:l,partials:t,decorators:e.decorators}))?i:"")+'\t\t<a href="'+u(typeof(o=null!=(o=p(l,"upgradeUrl")||(null!=n?p(n,"upgradeUrl"):n))?o:r)===c?o.call(s,{name:"upgradeUrl",hash:{},data:a,loc:{start:{line:7,column:11},end:{line:7,column:25}}}):o)+'" class="butt large pink pro-cta '+(null!=(i=p(l,"if").call(s,null!=n?p(n,"fixedWidthButton"):n,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:7,column:58},end:{line:7,column:100}}}))?i:"")+'">'+u(typeof(o=null!=(o=p(l,"proCTAButtonText")||(null!=n?p(n,"proCTAButtonText"):n))?o:r)===c?o.call(s,{name:"proCTAButtonText",hash:{},data:a,loc:{start:{line:7,column:102},end:{line:7,column:122}}}):o)+'</a>\n\t</div>\n</div>\n\n<div class="signup-modal-footer">\n\t<span>'+u((p(l,"intlMessage")||n&&p(n,"intlMessage")||r).call(s,{name:"intlMessage",hash:{intlName:"common.HAVE_A_FLICKR_ACCOUNT"},data:a,loc:{start:{line:12,column:7},end:{line:12,column:62}}}))+'</span>\n\t<a href="/signin" class="signin-link">'+u((p(l,"intlMessage")||n&&p(n,"intlMessage")||r).call(s,{name:"intlMessage",hash:{intlName:"common.SIGN_IN"},data:a,loc:{start:{line:13,column:39},end:{line:13,column:80}}}))+"</a>\n</div>\n"},usePartial:!0,useData:!0}),t={};e.Array.each(["pro-benefits-list"],(function(n){var l=e.Template.get("hermes/"+n);l&&(t[n]=l)})),e.Template.register("hermes/sign-up-dialog",(function(n,a){return(a=a||{}).partials=a.partials?e.merge(t,a.partials):t,l(n,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-pro-benefits-list"]});YUI.add("sign-up-dialog-view",(function(t,i){var o=new t.SubscriptionsHelper;t.FlickrView.create(this.name,t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.set("isActiveViewAgnostic",!0),t.title=void 0!==t.title?t.title:"",t.htmlMessage=void 0!==t.htmlMessage?t.htmlMessage:"",t.showCloseXButton=void 0===t.showCloseXButton||t.showCloseXButton,t.confirmButtonText=void 0!==t.confirmButtonText?t.confirmButtonText:this.intlMessage({intlName:"common.OK"}),t.confirmButtonIsDangerous=void 0!==t.confirmButtonIsDangerous&&t.confirmButtonIsDangerous,t.subMessage=void 0!==t.subMessage?t.subMessage:"",t.fixedWidthButton=void 0!==t.fixedWidthButton&&t.fixedWidthButton,t.getProCTA=void 0!==t.getProCTA&&t.getProCTA,t.proCTATitle=void 0!==t.proCTATitle?t.proCTATitle:this.intlMessage({intlName:"common.GO_PRO_ULTIMATE_EXPERIENCE"}),t.proCTAButtonText=void 0!==t.proCTAButtonText?t.proCTAButtonText:this.intlMessage({intlName:"common.UPGRADE_TO_PRO_BTN"}),t.upgradeUrl=void 0!==t.upgradeUrl?t.upgradeUrl:"/account/upgrade/pro",t.fireModalActionClick=void 0===t.fireModalActionClick||t.fireModalActionClick,t.fireModalReadyToClose=void 0===t.fireModalReadyToClose||t.fireModalReadyToClose,this.onConfirm=void 0!==t.onConfirm?t.onConfirm:async(t,i)=>{},this.onClose=void 0!==t.onClose?t.onClose:async(t,i)=>{},this.params=t,this.subviewConfig["cta-dialog-view"]=Object.assign(this.subviewConfig["cta-dialog-view"],{title:this.params.title,htmlMessage:this.params.htmlMessage,showCloseXButton:this.params.showCloseXButton,confirmButtonText:this.params.confirmButtonText,confirmButtonIsDangerous:this.params.confirmButtonIsDangerous,subMessage:this.params.subMessage,fixedWidthButton:this.params.fixedWidthButton,fireModalActionClick:this.params.fireModalActionClick,fireModalReadyToClose:this.params.fireModalReadyToClose,onConfirm:this.params.onConfirm,onClose:this.params.onClose}),this},subviewConfig:{"cta-dialog-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1}},loadState:function(){return Promise.resolve()},buildContainer:function(){return this.setContainerWithTemplate("sign-up-dialog",{getProCTA:this.params.getProCTA,proCTATitle:this.params.proCTATitle,benefits:o.PRO_BENEFITS,proCTAButtonText:this.params.proCTAButtonText,fixedWidthButton:this.params.fixedWidthButton,upgradeUrl:this.params.upgradeUrl}),this}})}),"@VERSION@",{requires:["flickr-view","hermes-template-sign-up-dialog","hermes-template-pro-benefits-list"],langBundles:["common"]});YUI.add("photo-card-helper",(function(e,t){e.mix({langBundles:["common","feed","feed-new"]},e.Localizable);var o=require("justified-layout");e.PhotoCardHelper=function(t){var i={layoutValues:{large:{BATCH_CARD_SPACING:4,BATCH_TARGET_ROW_HEIGHT:150,BATCH_TARGET_ROW_HEIGHT_TOLERANCE:.3,BATCH_ROW_HEIGHT_RATIO:.5},medium:{BATCH_CARD_SPACING:4,BATCH_TARGET_ROW_HEIGHT_TOLERANCE:.3},compact:{BATCH_CARD_SPACING:8,BATCH_TARGET_ROW_HEIGHT:180,BATCH_TARGET_ROW_HEIGHT_TOLERANCE:.3,SINGLE_PHOTO_HEIGHT:250}},ATTRIBUTION_HEADER_HEIGHT:58,DETAILS_FOOTER_HEIGHT:70,INFO_BAR_HEIGHT:52,MAX_PHOTO_AR:2.5,MIN_PHOTO_AR:.5,MANUAL_PORTRAIT_AR:.75,MANUAL_LANDSCAPE_AR:2,getCappedPhotoHeight:function(e){e.height;return Math.min(e.height,Math.max(t.viewportData.getHeight()*e.viewportProportion-e.additionalCardHeight,e.minHeight))},getClampedPhotoAspectRatio:function(e){return Math.min(Math.max(e,this.MIN_PHOTO_AR),this.MAX_PHOTO_AR)},generateCompactBatchLayout:function(e){var t,i,a=this,n=1===e.photoItems.length?this.layoutValues.compact.SINGLE_PHOTO_HEIGHT:this.layoutValues.compact.BATCH_TARGET_ROW_HEIGHT;t=e.photoItems.map((function(e){return a.getClampedPhotoAspectRatio(e.aspectRatio)})),(i=o(t,{containerWidth:e.width,containerPadding:0,boxSpacing:{horizontal:this.layoutValues.compact.BATCH_CARD_SPACING,vertical:this.layoutValues.compact.BATCH_CARD_SPACING},targetRowHeight:n,targetRowHeightTolerance:this.layoutValues.compact.BATCH_TARGET_ROW_HEIGHT_TOLERANCE})).width=e.width;var u=i.boxes[0].top,l=[0],s=0;return i.boxes.some((function(e,t){if(e.top>u){if(s+=i.boxes[l[l.length-1]].height+a.layoutValues.compact.BATCH_CARD_SPACING,l.push(t),l.length>3)return!0;u=e.top}})),l.length>3&&(i.boxes=i.boxes.slice(0,l[l.length-1]),i.containerHeight=s),i},generateThreeMaxLayout:function(e){var o=this,i={},a=[],n=[],u=e.photoItems.length;return 2===(n=(n=e.photoItems.map((function(e){return o.getClampedPhotoAspectRatio(e.aspectRatio)}))).slice(0,3)).length?n[0]>1&&n[1]>1?(a.push(n.slice(0,1)),a.push(n.slice(1,2)),i=this.buildCustomRowsLayout(a,e)):(a.push(n.slice(0,2)),i=this.buildCustomRowsLayout(a,e)):3===n.length&&(n[0]>1&&n[1]>1&&n[2]>1||n[0]>1&&n[1]>1&&n[2]<=1||n[0]>1&&n[1]<=1&&n[2]>1||n[0]>1&&n[1]<=1&&n[2]<=1?(a.push(n.slice(0,1)),a.push(n.slice(1,3)),i=this.buildCustomRowsLayout(a,e)):n[0]<=1&&n[1]>1&&n[2]>1?(u>3?a.push(n.slice(0,2)):(a.push(n.slice(0,2)),a.push(n.slice(2,3))),i=this.buildCustomRowsLayout(a,e)):n[0]<=1&&n[1]>1&&n[2]<=1?(a.push(n.slice(0,2)),i=this.buildCustomRowsLayout(a,e)):n[0]<=1&&n[1]<=1&&n[2]>1?(u>3?a.push(n.slice(0,2)):(a.push(n.slice(0,2)),a.push(n.slice(2,3))),i=this.buildCustomRowsLayout(a,e)):n[0]<=1&&n[1]<=1&&n[2]<=1&&(a.push(n.slice(0,3)),i=this.buildCustomRowsLayout(a,e))),Math.max.apply(Math,i.boxes.map((function(e){return e.height})))>.8*t.viewportData.getHeight()&&((a=[]).push(n.slice(0,2)),i=this.buildCustomRowsLayout(a,e)),i},buildCustomRowsLayout:function(e,t){var o=this,i=0,a={boxes:[]};return e.forEach((function(n,u){var l={horizontal:o.layoutValues.large.BATCH_CARD_SPACING,vertical:o.layoutValues.large.BATCH_CARD_SPACING},s=o.generateCustomJustifiedRow(n,{containerWidth:t.width,padding:l.horizontal,top:0===u?0:i});a.boxes=a.boxes.concat(s),i+=u!==e.length-1?s[0].height+l.vertical:s[0].height})),a.containerHeight=i,a},generateCustomJustifiedRow:function(e,t){var o=e.reduce((function(e,t,o){return e+t}),0),i=(t.containerWidth-t.padding*(e.length-1))/o,a=0;return e.map((function(e,o){var n=a;return a+=i*e+t.padding,{aspectRatio:e,width:i*e,height:i,left:n,top:t.top}}))},scaleLayout:function(e,t,o,i,a){var n,u=0,l=0,s=[];return e.boxes.forEach((function(e,o){i||(e.width*=t,e.left*=t),a||(e.height*=t,e.top*=t)})),s.push([]),e.boxes.forEach((function(e,t){e.top>l&&(u++,l=e.top,s.push([])),s[u].push(e)})),n=0,s.forEach((function(u,l){var r=o,g=r*t,h=0;u.forEach((function(e,t){i||(e.width-=(r-g)*(u.length-1)/u.length,e.left=h+t*r,h+=e.width),a||(e.height-=(r-g)*(s.length-1)/s.length,e.top=n+l*r,t===u.length-1&&(n+=u[0].height))})),i||(e.width=h+(u.length-1)*r)})),a||(e.containerHeight=n+(s.length-1)*o),e},convertPhotoModel:function(t){var o,i=t.getValue("owner"),a=t.getValue("engagement"),n=i.getValue("isPro");return"photo-lite-models"===t.registry.name?(o=this.convertEngagementModel(t),{id:e.guid(),layoutRenderType:"photo",photoId:t.getValue("id"),aspectRatio:t.getValue("aspectRatio"),sizes:t.getValue("sizes"),url:t.getValue("url"),title:t.getValue("title"),description:t.getValue("description"),mediaType:t.getValue("mediaType"),contentType:t.getValue("contentType"),isVideo:t.getValue("isVideo"),owner:{nsid:i.getValue("nsid"),url:i.getValue("url"),displayname:i.getValue("displayname"),pathAlias:i.getValue("pathAlias"),isPro:n,proBadgeType:n?i.getValue("proBadge"):void 0,model:t.getValue("owner")},engagement:o,isOwner:t.getValue("isOwner"),needsInterstitial:t.getValue("needsInterstitial"),model:t,engagementModel:a}):(o=this.convertEngagementModel(a),{id:e.guid(),layoutRenderType:"photo",photoId:t.getValue("id"),aspectRatio:t.getValue("aspectRatio"),sizes:t.getValue("sizes"),url:t.getValue("url"),title:t.getValue("title"),description:t.getValue("description"),mediaType:t.getValue("mediaType"),contentType:t.getValue("contentType"),isVideo:t.getValue("isVideo"),owner:{nsid:i.getValue("nsid"),url:i.getValue("url"),displayname:i.getValue("displayname"),buddyicon:i.getValue("buddyicon"),pathAlias:i.getValue("pathAlias"),isPro:n,proBadgeType:n?i.getValue("proBadge"):void 0,model:t.getValue("owner")},engagement:o,isOwner:t.getValue("isOwner"),needsInterstitial:t.getValue("needsInterstitial"),safetyLevel:t.getValue("safetyLevel"),model:t,engagementModel:a})},convertEngagementModel:function(e){return"photo-lite-models"===e.registry.name?{photoId:e.getValue("id"),isFaved:e.getValue("isFaved"),faveCount:e.getValue("faveCount"),commentCount:e.getValue("commentCount"),canFave:e.getValue("canFave"),reactions:t.flipper.isFlipped("enable-likes")?e.getValue("reactions"):void 0,model:e}:{photoId:e.getValue("id"),isFaved:e.getValue("isFaved"),faveCount:e.getValue("faveCount"),commentCount:e.getValue("commentCount"),viewCount:e.getValue("viewCount"),canFave:e.getValue("canFave"),reactions:t.flipper.isFlipped("enable-likes")?e.getValue("reactions"):void 0,model:e}},checkInsideViewport:function(t,o,i){var a=t?t.getDOMNode().getBoundingClientRect():void 0;if(o=o||0,a&&a.height>0){if(i&&a.top>=-o&&a.bottom<=e.config.win.innerHeight+o)return!0;if(!i&&a.bottom>=-o&&a.top<=e.config.win.innerHeight+o)return!0}return!1}};return e.augment(i,e.EventTarget),i}}),"@VERSION@",{requires:["event-custom","storage-helper"],optionalRequires:["hermes-core"]});YUI.add("nsfw-helper",(function(e){const t=e.mix({langBundles:["common","photo-page-scrappy","account-menu","adult-content-overlay"]},e.Localizable),a=new e.SubscriptionsHelper;e.NSFWHelper=class{static getPhotoCardConfig(e="notPro"){return{...this.getMessageConfig(e),showIcon:!0,isCompact:!0}}static getPhotoPageConfig(e="wrongSetting"){return{...this.getMessageConfig(e),showIcon:!0,isLarge:!0}}static getSearchModalConfig(){const e=this.getMessageConfig("notPro");return e.upgradeUrl=a.getProLandingPageUrl(a.UTM_FREE_USER_SAFE_SEARCH_CHANGE),e}static getMessageConfig(e){const s=a.getProLandingPageUrl(a.UTM_NSFW_INTERSTITIAL),o={wrongSetting:{details:t.intlHTMLMessage({intlName:"photo-page-scrappy.USER_DISCRETION"}),cta:t.intlHTMLMessage({intlName:"adult-content-overlay.SHOW_ME_FROM_NOW_ON_CTA",upgradeUrl:s}),bottom:t.intlHTMLMessage({intlName:"photo-page-scrappy.CHANGE_SAFE_SEARCH_IN_SETTINGS"}),upgradeUrl:s},notPro:{main:t.intlHTMLMessage({intlName:"adult-content-overlay.MATURE_AUDIENCES"}),details:t.intlHTMLMessage({intlName:"adult-content-overlay.JOIN_PRO_TO_VIEW",upgradeUrl:s}),cta:t.intlMessage({intlName:"common.GET_PRO"}),bottom:void 0,upgradeUrl:s},signedOut:{details:t.intlHTMLMessage({intlName:"adult-content-overlay.JOIN_PRO_TO_VIEW",upgradeUrl:s}),cta:t.intlMessage({intlName:"common.SIGN_UP"}),bottom:t.intlMessage({intlName:"common.HAVE_FLICKR_SIGN_IN"})},isMinor:{details:void 0,cta:void 0,bottom:void 0}}[e];return{mainMessage:o.main,detailsMessage:o.details,bottomMessage:o.bottom,ctaMessage:o.cta,upgradeUrl:o.upgradeUrl}}constructor({viewerNsid:e,appContext:t}){this.appContext=t,this.viewerNsid=e}async load(){this.viewerNsid&&(this.viewerPrefsModel=await this.appContext.getModel("person-preferences-models",this.viewerNsid))}async updateSafetyLevel({safetyLevel:e,onSuccess:t,onError:a,photoModelRegistry:s}){this.viewerPrefsModel.setValue("safeSearch",e);try{await this.viewerPrefsModel.registry.remoteUpdate(this.viewerNsid),s.attributeSearch({needsInterstitial:!0}).forEach((e=>{s.getValue(e,"safetyLevel")<=this.viewerPrefsModel.getValue("safeSearch")&&s.setValue(e,"needsInterstitial",!1)})),t()}catch(e){a(e)}}}}),"@VERSION@",{requires:["localizable","subscriptions-helper"],langBundles:["common","photo-page-scrappy","account-menu","adult-content-overlay"]});