/* HouseHold ImplementationValidator LegacyLayer PLEMetrics SignalsAbs SignalsAutoInsertion SignalsBsc SignalsCbs SignalsIds SignalsTvp SignalsVlp */
(()=>{var ur=Object.create;var Me=Object.defineProperty,dr=Object.defineProperties,bt=Object.getOwnPropertyDescriptor,cr=Object.getOwnPropertyDescriptors,gr=Object.getOwnPropertyNames,wt=Object.getOwnPropertySymbols,mr=Object.getPrototypeOf,Pt=Object.prototype.hasOwnProperty,pr=Object.prototype.propertyIsEnumerable;var nt=(n,e,t)=>e in n?Me(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,M=(n,e)=>{for(var t in e||(e={}))Pt.call(e,t)&&nt(n,t,e[t]);if(wt)for(var t of wt(e))pr.call(e,t)&&nt(n,t,e[t]);return n},Ue=(n,e)=>dr(n,cr(e)),o=(n,e)=>Me(n,"name",{value:e,configurable:!0});var Ct=(n,e)=>()=>(n&&(e=n(n=0)),e);var fr=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var hr=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of gr(e))!Pt.call(n,i)&&i!==t&&Me(n,i,{get:()=>e[i],enumerable:!(r=bt(e,i))||r.enumerable});return n};var vr=(n,e,t)=>(t=n!=null?ur(mr(n)):{},hr(e||!n||!n.__esModule?Me(t,"default",{value:n,enumerable:!0}):t,n));var l=(n,e,t,r)=>{for(var i=r>1?void 0:r?bt(e,t):e,u=n.length-1,c;u>=0;u--)(c=n[u])&&(i=(r?c(e,t,i):c(i))||i);return r&&i&&Me(e,t,i),i};var d=(n,e,t)=>nt(n,typeof e!="symbol"?e+"":e,t);var T=(n,e,t)=>new Promise((r,i)=>{var u=v=>{try{f(t.next(v))}catch(y){i(y)}},c=v=>{try{f(t.throw(v))}catch(y){i(y)}},f=v=>v.done?r(v.value):Promise.resolve(v.value).then(u,c);f((t=t.apply(n,e)).next())});var g,s=Ct(()=>{g={"71347885":{adServerId:3843,customTracking:{c1:{type:"targeting",key:"permutive"}}}}});var a=Ct(()=>{});var Jt=fr((Eg,Xt)=>{s();a();function kr(n,e){if(typeof n!="function")throw new TypeError(`Expected the first argument to be a \`function\`, got \`${typeof n}\`.`);let t,r=0;return o(function(...u){clearTimeout(t);let c=Date.now(),f=c-r,v=e-f;v<=0?(r=c,n.apply(this,u)):t=setTimeout(()=>{r=Date.now(),n.apply(this,u)},v)},"throttled")}o(kr,"throttle");Xt.exports=kr});s();a();s();a();s();a();s();a();s();a();s();a();s();a();var x=[];for(let n=0;n<256;++n)x.push((n+256).toString(16).slice(1));function Dt(n,e=0){return(x[n[e+0]]+x[n[e+1]]+x[n[e+2]]+x[n[e+3]]+"-"+x[n[e+4]]+x[n[e+5]]+"-"+x[n[e+6]]+x[n[e+7]]+"-"+x[n[e+8]]+x[n[e+9]]+"-"+x[n[e+10]]+x[n[e+11]]+x[n[e+12]]+x[n[e+13]]+x[n[e+14]]+x[n[e+15]]).toLowerCase()}o(Dt,"unsafeStringify");s();a();var it,Tr=new Uint8Array(16);function ot(){if(!it){if(typeof crypto=="undefined"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");it=crypto.getRandomValues.bind(crypto)}return it(Tr)}o(ot,"rng");s();a();s();a();var yr=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),st={randomUUID:yr};function Er(n,e,t){var i,u,c;if(st.randomUUID&&!e&&!n)return st.randomUUID();n=n||{};let r=(c=(u=n.random)!=null?u:(i=n.rng)==null?void 0:i.call(n))!=null?c:ot();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){if(t=t||0,t<0||t+16>e.length)throw new RangeError(`UUID byte range ${t}:${t+15} is out of buffer bounds`);for(let f=0;f<16;++f)e[t+f]=r[f];return e}return Dt(r)}o(Er,"v4");var at=Er;var K=o(()=>at(),"uuid");s();a();var be=o((n,e)=>(...t)=>{try{let r=n(...t);return r instanceof Promise?r.then(i=>i,i=>e(i,...t)):r}catch(r){return e(r,...t)}},"withErrorHandler");s();a();var Pe,Ce,De,z=class z{constructor(e,t){d(this,"collections",new Set);d(this,"children",new z.Set);d(this,"beforeDestroyed");this.beforeDestroyed=t!=null?t:()=>{};for(let[r,i]of Object.entries(e))Object.defineProperty(this,r,{value:i});e.parent!=null&&(e.parent.destroyed?this.destroy():e.parent.children.add(this))}static Create(e,t){return new z(e,t)}static CreateRoot(e,t){return new z(e,t)}destroy(){if(this.beforeDestroyed!=null){try{this.beforeDestroyed(this)}catch(e){}for(let e of this.children)e.destroy();this.beforeDestroyed=void 0;for(let e of this.collections)e.delete(this)}return this}get destroyed(){return this.beforeDestroyed==null}};o(z,"EntityClass"),d(z,"Set",(Pe=class extends Set{add(t){return t.destroyed||(t.collections.add(this),super.add(t)),this}delete(t){return t.collections.delete(this),super.delete(t)}clear(){for(let t of this.values())t.collections.delete(this);super.clear()}peek(){return this.values().next().value}conjure(t){let r=this.peek();return r==null&&(r=t(),this.add(r)),r}},o(Pe,"EntitySet"),Pe)),d(z,"Map",(Ce=class extends Map{set(t,r){return t.destroyed||(t.collections.add(this),super.set(t,r)),this}delete(t){return t.collections.delete(this),super.delete(t)}clear(){for(let t of this.keys())t.collections.delete(this);return super.clear()}summon(t,r){let i=super.get(t);return i==null&&(i=r,this.set(t,i)),i}conjure(t,r){let i=super.get(t);return i==null&&(i=r(),this.set(t,i)),i}},o(Ce,"EntityMap"),Ce)),d(z,"Link",(De=class extends z.Map{get(t){return super.conjure(t,()=>new z.Set)}},o(De,"EntityLink"),De));var ve=z,E;(u=>(u.Set=ve.Set,u.Map=ve.Map,u.Link=ve.Link,u.Create=ve.Create,u.CreateRoot=ve.CreateRoot))(E||(E={}));s();a();var Qe=class Qe{constructor(e,t,r){d(this,"_message","unknown");d(this,"_trace",[]);d(this,"_silenced",!1);if(e instanceof Qe)return e.addToTrace(r,t);typeof e=="object"&&e!=null&&"message"in e&&typeof e.message=="string"?this._message=e.message:this._message=`${e}`,this.addToTrace(r,t)}get message(){return this._message}get trace(){return this._trace}get silenced(){return this._silenced}silence(){return this._silenced=!0,this}addToTrace(e,t){return this._trace.unshift(e),this.maybeCompleteTrace(t),this}maybeCompleteTrace(e){return T(this,null,function*(){let t=this._trace.length;yield Promise.resolve(),yield Promise.resolve(),yield Promise.resolve(),!this.silenced&&t===this._trace.length&&e(this)})}};o(Qe,"TracedError");var qe=Qe;var lt=class lt{constructor(e){d(this,"moduleInstances",new Map);d(this,"methodsToExecute",[]);d(this,"errorHandlers",[]);d(this,"activeSession",null);for(let t of e)this.createModule(t);for(let t of this.moduleInstances.values())this.applyModuleDecoration(t),this.applyExecuteDecoration(t),this.applyPluginDecoration(t),this.applyErrorDecoration(t),this.applyCatchErrorDecoration(t)}get session(){if(this.activeSession==null)throw new Error("Core has no active session");return this.activeSession}get(e){return this.getModule(e)}execute(){if(this.activeSession==null){this.activeSession=E.CreateRoot({id:K()});for(let e of this.methodsToExecute)e()}}reset(){this.activeSession!=null&&(this.activeSession.destroy(),this.activeSession=null)}get modules(){let e={};for(let[t,r]of this.moduleInstances)e[t.name]=r;return e}getModule(e){let t=this.moduleInstances.get(e);if(t==null)throw new Error(`module not in core: ${e.name}`);return t}createModule(e){if(e.prototype.moduleConfig==null)throw new Error(`not a module: ${e.name}`);let t=new e;return t.core=this,this.moduleInstances.set(e,t),t}applyModuleDecoration(e){var r;let t=e.constructor.prototype.moduleConfig;for(let{method:i}of t)e[i]=be(e[i].bind(e),(u,...c)=>{throw this.traceError(u,`${e.constructor.name}.${i}(${c.map(f=>typeof f).join(",")})`)});(r=e.plugins)!=null||(e.plugins={}),e.pluginFunctions={};for(let i of Object.keys(e.plugins))e.pluginFunctions[i]=[],e.plugins[i]=(...u)=>{let c=[];for(let f of e.pluginFunctions[i])f(c,...u);return c}}applyExecuteDecoration(e){var r;let t=(r=e.constructor.prototype.executeConfig)!=null?r:[];for(let{method:i}of t)this.methodsToExecute.push(be(e[i],u=>{this.traceError(u,"@execute")}))}applyPluginDecoration(e){var r;let t=(r=e.constructor.prototype.pluginConfig)!=null?r:[];for(let{PluggableClass:i,category:u,method:c}of t)this.getModule(i).pluginFunctions[u].push(be((f,...v)=>{f.push(e[c](...v))},f=>{this.traceError(f,`@plugin(${i.name},'${u}')`)}))}applyErrorDecoration(e){var r;let t=(r=e.constructor.prototype.errorConfig)!=null?r:[];for(let{method:i}of t)this.errorHandlers.push(be(e[i],u=>{u instanceof qe&&u.silence()}))}applyCatchErrorDecoration(e){var r;let t=(r=e.constructor.prototype.catchErrorConfig)!=null?r:[];for(let{method:i}of t)e[i]=be(e[i],u=>{this.traceError(u,"@catchError")})}traceError(e,t){return new qe(e,r=>this.reportError(r),t)}reportError(e){for(let t of this.errorHandlers)t(e.message,[...e.trace])}};o(lt,"Core");var ke=lt;s();a();s();a();var ut=[],ze=ut;var p=o(n=>{let e=n.prototype,t=Object.getOwnPropertyNames(e).filter(r=>{var i;return r!=="constructor"&&((i=Object.getOwnPropertyDescriptor(e,r))==null?void 0:i.value)instanceof Function});e.moduleConfig=t.map(r=>({method:r})),ut.push(n)},"moduleClass"),N=o(n=>e=>{},"attachModule"),b=o((n,e)=>{var t;n.executeConfig=(t=n.executeConfig)!=null?t:[],n.executeConfig.push({method:e})},"executeMethod"),h=o((n,e)=>(t,r)=>{var i;t.pluginConfig=(i=t.pluginConfig)!=null?i:[],t.pluginConfig.push({PluggableClass:n,category:e,method:r})},"pluginMethod"),Fe=o((n,e)=>{var t;n.catchErrorConfig=(t=n.catchErrorConfig)!=null?t:[],n.catchErrorConfig.push({method:e})},"catchErrorMethod"),dt=o((n,e)=>{var t;n.errorConfig=(t=n.errorConfig)!=null?t:[],n.errorConfig.push({method:e})},"errorMethod");s();a();s();a();var xe=o(n=>{if(n==null)return[];let e=xt(n);return e!=null?[e]:Array.isArray(n)?n.map(xt).filter(t=>t!=null):[]},"parseSlotSizes"),xt=o(n=>{if(n==null)return null;if(typeof n=="string")return{label:n};if(Array.isArray(n)){if(n.length===1&&typeof n[0]=="string")return{label:n[0]};if(n.length===2&&typeof n[0]=="number"&&typeof n[1]=="number")return{width:n[0],height:n[1]}}if(typeof n=="object"){let{label:e,width:t,height:r}=n;if(typeof t=="number"&&typeof r=="number")return{width:t,height:r};if(typeof e=="string")return{label:e}}return null},"parseSlotSize");s();a();var It=o(n=>{try{return n.getSizes()}catch(e){return[]}},"getGptSlotSizesSafe");s();a();var Ye=o(n=>{let e=n.split("/").map(i=>i.trim()).filter(i=>i.length>0);if(e.length<2)return;let t=e[0].split(",",1)[0],r=Number(t);return Number.isNaN(r)?void 0:`${r}`},"getNetworkCodeFromAdUnit");var He=o((n,e)=>{let t=n.getAdUnitPath(),r=Ye(t);return{id:t,network:r,sizes:xe(It(n)),position:n.getTargeting(e)[0]}},"gptSlotToAdUnit");s();a();s();a();s();a();s();a();s();a();s();a();s();a();var ct="dvp_spos";var X=class{_getAdServers(){try{return g}catch(e){return{}}}isAdServerConfigured(e){return e!=null&&e in this._getAdServers()}getAdServerConfig(e){var t;return e==null||!this.isAdServerConfigured(e)?{}:(t=this._getAdServers()[e])!=null?t:{}}getAdServerCustomTracking(e){var t;return e==null||!this.isAdServerConfigured(e)?{}:(t=this._getAdServers()[e].customTracking)!=null?t:{}}getAdServerId(e){if(!(e==null||!this.isAdServerConfigured(e)))return this._getAdServers()[e].adServerId}getAdPositionKey(e){var t,r;return e==null?ct:(r=(t=this._getAdServers()[e])==null?void 0:t.adPositionKey)!=null?r:ct}};o(X,"AdServers"),X=l([p],X);s();a();var S=class{constructor(){d(this,"timeFunction",new E.Map)}window(){return window}document(){return this.window().document}pageUrl(){var e,t;return(t=(e=this.window().location)==null?void 0:e.href)!=null?t:""}hostname(){return new URL(this.pageUrl()).hostname}time(){return this.timeFunction.conjure(this.core.session,()=>{let e=this.window(),t=!1;try{t=typeof e.performance.now()=="number"}catch(r){}return t?()=>Math.floor(e.performance.now()):()=>e.Date.now()})()}sendBeacon(e){try{let t=this.window().navigator;typeof(t==null?void 0:t.sendBeacon)=="function"?t.sendBeacon(e):new Image().src=e}catch(t){}}};o(S,"Env"),S=l([p],S);s();a();var R=class{constructor(){d(this,"plugins",{slotDiscovered:o((e,t)=>[],"slotDiscovered")});d(this,"slots",new E.Set)}getSlot(e,t){for(let r of this.slots)if(r.adServer===e&&r.elementId===t)return r}getSlots(e){let t=[...this.slots];return e==null?t:t.filter(r=>r.adServer===e)}createSlot(e,t,r,i,u){let c=this.getSlot(e,r);c!=null&&c.destroy();let f=E.Create({parent:this.core.session,adServer:e,elementId:r,adUnit:i,uuid:K(),creationTime:Date.now()});return this.slots.add(f),u==null||u(f),this.plugins.slotDiscovered(f,t),f}};o(R,"SlotStore"),R=l([p],R);s();a();s();a();s();a();var se=o((...n)=>{let e=[];for(let t of n)if(t!=null)for(let r of t)e.includes(r)||e.push(r);return e},"mergeUnique");var w=class{constructor(){d(this,"plugins",{getAdServerTargeting:o((e,t)=>[],"getAdServerTargeting"),setAdServerTargeting:o((e,t,r)=>[],"setAdServerTargeting")});d(this,"globalTargeting",{});d(this,"slotTargeting",new E.Map)}_getSlotTargeting(e){return this.slotTargeting.summon(e,{})}_getTargetingKeys(e){return se(Object.keys(this.globalTargeting),Object.keys(this._getSlotTargeting(e)))}_getTargetingValues(e,t){return se(this.globalTargeting[t],this._getSlotTargeting(e)[t])}getTargeting(e){let t={};if(e==null)for(let r of Object.keys(this.globalTargeting))t[r]=[...this.globalTargeting[r]];else for(let r of this._getTargetingKeys(e))t[r]=this._getTargetingValues(e,r);return t}setSlotTargeting(e,t,r=!1){var c;let i=Object.keys(t),u=this._getSlotTargeting(e);for(let f of i)u[f]=se(t[f],r?(c=this.slotTargeting.get(e))==null?void 0:c[f]:null);this.setAdServerTargeting(e,i)}setGlobalTargeting(e,t=!1){let r=Object.keys(e);for(let i of r)this.globalTargeting[i]=se(e[i],t?this.globalTargeting[i]:null);for(let i of this.core.get(R).getSlots())this.setAdServerTargeting(i,r)}getAdServerTargeting(e,t){var r;return(r=this.plugins.getAdServerTargeting(e,t).find(i=>i.length!==0))!=null?r:[]}setAdServerTargeting(e,t){t==null&&(t=this._getTargetingKeys(e));for(let r of t)this.plugins.setAdServerTargeting(e,r,this._getTargetingValues(e,r))}_onSlotDiscovered(e){this.setAdServerTargeting(e)}};o(w,"TargetingHub"),l([h(R,"slotDiscovered")],w.prototype,"_onSlotDiscovered",1),w=l([p],w);s();a();s();a();s();a();var Rr=[[/((\?)|&)(?:amp_lite|fr=operanews)/g,"$2"],[/(^https?:\/\/)(www\.)/g,"$1"],[/(((\?)|&|%3F|%26|;)(?:utm_campaign|utm_source|utm_content|utm_term|utm_viral|utm_medium|utm_identifier|utm_key|fb_source|referrer|referer|ref|rand|rnd|randid|\.?rand|\.?partner|cb|count|adid|session|sessionid|session_redirect|param\d|userinfo|uid|refresh|ocid|ncid|clickenc|fbclid|amp_js_v|amp_gsa|ns_source|ns_campaign|ns_mchanel|ns_mchannel|ns_linkname|ns_fee|src|ex_cid|usqp|source|xid|trkid|utm_social-type|mbid|utm_brand|__twitter_impression|utm_referrer|CMP|cmp|_cmp|cq_cmp)=[^&]*)/g,"$3"],[/[/.]amp(?:\/[?&]*)?$/g,""],[/((\?)|&)(?:outputType|isFollow|suppressMediaBar|cid|ICID|icid|bdk|wtu_id_h|utm_placement|intcmp|_native_ads|traffic_source|entry|\.tsrc|autoplay|autostart|dc_data|influencer|pubdate|utm_hp_ref|redirect|service|refresh_ce|refresh_cens|xcmg|target_id|_amp)=[^&]*/g,"$2"],[/(\?|&)(?:amp)(?:&|$|=[^&]*)/g,"$1"]],Ar=[[/(?:\/|\/\?|\?|&|\/\$0|#[\s\S]*)+$/g,""],[/(?:\/|\/\?|\?|&|\/\$0|#[\s\S]*)+$/g,""]],Ot=o((n,e)=>{for(let[t,r]of n)e=e.replace(t,r);return e},"replaceByRules"),Nt=o(n=>{let e=Ot(Rr,n);return Ot(Ar,e)},"normalizeUrl");s();a();var Lt=o(n=>n.split("?",1)[0].split("#",1)[0],"stripUrlQuery");s();a();var Mt=o((n,e)=>{try{let t=new URLSearchParams(n),r=t.get("ctx"),i=t.get("cmp");if(r!=null&&i!=null)return{ctx:r,cmp:i,prefetch:e,legacy:!0}}catch(t){}return null},"parseInfo"),Ut=o(n=>{var e;return n.pathname!=="/signals/pub.js"?null:(e=Mt(n.search,!0))!=null?e:Mt(n.hash.substring(1).split("?")[0],!1)},"parseLegacyPagetagUrl");var _r=1e3,wr=/^\/dvtag\/([^/]+)\/([^/]+)\/pub\.js$/,P=class{constructor(){d(this,"visit");d(this,"tagInfo");d(this,"plugins",{newVisit:o(e=>[],"newVisit"),overrideTagInfo:o(e=>[],"overrideTagInfo")});d(this,"_normalizeUrl",Nt)}_initialize(){this.getTagInfo(),this.updateVisit(!1),this.plugins.newVisit(this.visit),this._installNavigationListener()}getTagInfo(){var e;if(this.tagInfo==null){try{this.tagInfo=this._parseTagInfo()}catch(r){}(e=this.tagInfo)!=null||(this.tagInfo={ctx:"unknown",cmp:"unknown"});let t=this.plugins.overrideTagInfo(this.tagInfo);t.length>0&&(this.tagInfo=M(M({},this.tagInfo),t[0]))}return this.tagInfo}_parseTagInfo(){let e=this.getCurrentScriptSrc();if(e==null)return null;let t=new URL(e,"https://pub.doubleverify.com"),r=t.pathname,i=wr.exec(r);if(i!=null){let[,u,c]=i;return{ctx:u,cmp:c}}return Ut(t)}getCurrentScriptSrc(){var e,t;return(t=(e=this.core.get(S).window().document.currentScript)==null?void 0:e.getAttribute("src"))!=null?t:null}updateVisit(e=!0){var r,i;let t=this.getStrippedPageUrl();if(this.visit==null||this.visit.strippedUrl!==t){let u=K();this.visit={strippedUrl:t,normalizedUrl:this._normalizeUrl(this.core.get(S).window().location.href),uuid:u,sessionUuid:(i=(r=this.visit)==null?void 0:r.sessionUuid)!=null?i:u},e&&this.plugins.newVisit(this.visit)}return this.visit}getVisit(){var e;return(e=this.visit)!=null?e:this.updateVisit(!1)}getStrippedPageUrl(){return Lt(this.core.get(S).window().location.href)}getNormalizedPageUrl(){return this.getVisit().normalizedUrl}getVisitUuid(){return this.getVisit().uuid}getSessionUuid(){return this.getVisit().sessionUuid}_installNavigationListener(){var r;let e=this.core.get(S).window(),t=o(()=>this.updateVisit(!0),"cb");((r=e.navigation)==null?void 0:r.addEventListener)!=null?e.navigation.addEventListener("navigatesuccess",t):setInterval(t,_r)}};o(P,"Context"),l([b],P.prototype,"_initialize",1),P=l([p],P);s();a();s();a();var Se=o(()=>(...n)=>[],"apiPlugin"),I=class{constructor(){d(this,"plugins",{queueAdRequest:Se(),defineSlot:Se(),adRendered:Se(),adRemoved:Se(),getTargeting:Se(),addEventListener:o((e,t)=>[],"addEventListener"),removeEventListener:o((e,t)=>[],"removeEventListener"),toggleDebugMode:Se(),_debugScriptLoaded:Se()})}_initialize(){var r;let e=this.core.get(S).window(),t=(r=e.dvtag)!=null?r:{};e.dvtag=t,t.queueAdRequest=this.queueAdRequest,t.defineSlot=this.defineSlot,t.adRendered=this.adRendered,t.adRemoved=this.adRemoved,t.getTargeting=this.getTargeting,t.addEventListener=this.addEventListener,t.removeEventListener=this.removeEventListener,t.toggleDebugMode=this.toggleDebugMode,t._debugScriptLoaded=this._debugScriptLoaded}queueAdRequest(...e){this.plugins.queueAdRequest(...e)}defineSlot(...e){this.plugins.defineSlot(...e)}adRendered(...e){this.plugins.adRendered(...e)}adRemoved(...e){this.plugins.adRemoved(...e)}getTargeting(...e){var t;return(t=this.plugins.getTargeting(...e)[0])!=null?t:{}}addEventListener(e,t){this.plugins.addEventListener(e,t)}removeEventListener(e,t){this.plugins.removeEventListener(e,t)}toggleDebugMode(...e){this.plugins.toggleDebugMode(...e)}_debugScriptLoaded(...e){this.plugins._debugScriptLoaded(...e)}};o(I,"Api"),l([b],I.prototype,"_initialize",1),I=l([p],I);s();a();var gt=class gt{constructor(){d(this,"pending",[]);d(this,"flushing",!1)}push(e){this.pending.push(e),this.flush()}flush(){return T(this,null,function*(){var t;if(this.flushing)return;this.flushing=!0;let e=this.pending.shift();for(;e!=null;){try{yield e.promise}catch(r){}try{(t=e.callback)==null||t.call(e)}catch(r){}e=this.pending.shift()}this.flushing=!1})}};o(gt,"AsyncQueue");var We=gt;var A=class{constructor(){d(this,"plugins",{adRequestQueued:o(e=>[],"adRequestQueued"),adRequestTimedOut:o(e=>[],"adRequestTimedOut"),adRequestBeforeRelease:o(e=>[],"adRequestBeforeRelease"),adRequestCompleted:o(e=>[],"adRequestCompleted")});d(this,"queue",new We);d(this,"adRequestCounter",0)}_queueAdRequest(e={}){var u,c;let t={index:this.adRequestCounter++,status:"queued",timeoutValue:(u=e.timeout)!=null?u:0,onDvtagReadyCalled:(c=e.timestamp)!=null?c:0,waitingStarted:new Date().getTime(),internal:e.internal};this.core.get(P).updateVisit(),this.plugins.adRequestQueued(t);let r=e.callback;r===void 0?e.callback=()=>{}:r===null?t.status="tag-timeout":e.callback=()=>{t.status="queue-timeout",t.callbackCalled=new Date().getTime(),e.callback=null,this.plugins.adRequestTimedOut(t);try{r()}catch(f){}};let i=o(()=>{if(e.callback!=null){e.callback=null,t.status="success",t.callbackCalled=new Date().getTime(),this.plugins.adRequestBeforeRelease(t);try{r==null||r()}catch(f){}}else this.plugins.adRequestBeforeRelease(t);t.waitingEnded=new Date().getTime(),this.plugins.adRequestCompleted(t)},"onAsyncOperationsCompleted");this.queue.push({callback:i,adRequest:t})}delayAdRequests(e){this.queue.push({promise:e})}};o(A,"AdRequestQueue"),l([h(I,"queueAdRequest")],A.prototype,"_queueAdRequest",1),A=l([p],A);s();a();s();a();s();a();var J=class{getShortCommitId(){return"3d7a33b"}getBuildTimestamp(){return 1749675640478}getAuthToken(){return"bJP8Zuv88o9u2XskkeUEho+JBoAkQ2qefN1RxOuV24sQ7Vmv7qIDAuAtc7qWuWnpxianey9SxQzivJs1LrFL1qL+Gxv1Sz8DCPqdRUgPj9m5491MfyuxVslRaO+pS2SmNfh3pUar0MT7XqJbwwsXgoGyiYsx42oMbRcxZys="}};o(J,"DefinedVariables"),J=l([p],J);var k=class{constructor(){d(this,"cache",new E.Map)}_performFetchJson(e,t){return T(this,null,function*(){let r=this.core.get(S).window().fetch,i=e;if(t!=null&&t.authToken){let u=this.core.get(J).getAuthToken(),c=new URL(e);c.searchParams.set("token",u),i=c.href}try{return yield r(i).then(u=>u.json())}catch(u){return null}})}fetchJson(e,t){return T(this,null,function*(){let r=this.cache.summon(this.core.session,{}),i=r[e];return i==null&&(i=this._performFetchJson(e,t),r[e]=i),yield i})}};o(k,"Fetch"),k=l([p],k);s();a();var $e=["BSC","ABS","CCT","CBS"],mt=["IDS"],Ve=["VLP","TVP"],Pr=[...$e,...mt,...Ve],Qs=[...$e,...mt,...Ve].filter(n=>n!=="CCT"),qt=o(n=>Pr.includes(n.toUpperCase()),"isSignal"),kt=o(n=>Ve.includes(n.toUpperCase()),"isSlotSignal"),Ft=o(n=>mt.includes(n.toUpperCase()),"isUserSignal"),$t=o(n=>$e.includes(n.toUpperCase()),"isPageSignal");s();a();s();a();var Ke=o(n=>n==null?"":`@${n}`,"getPositionSuffix");s();a();var Cr=/^(\d+)x(\d+)$/,Vt=o(n=>n==="all"?[]:n.split(",").map(e=>{let t=e.match(Cr);return t==null?{label:e}:{width:parseInt(t[1],10),height:parseInt(t[2],10)}}),"stringToSlotSizes"),pt=o(n=>n.length===0?"all":n.map(({width:e,height:t,label:r})=>r!=null?r:`${e}x${t}`).join(","),"slotSizesToString"),Gt=o(n=>n==null?"":n.length>0&&n.every(({label:r})=>r==null)?pt(n):"","slotSizesToStringIfSpecific");var Dr="https://pub.doubleverify.com/dvtag/signals/",F=class{_getBaseUrl(e){let t=this.core.get(P),{ctx:r,cmp:i}=t.getTagInfo(),u=t.getNormalizedPageUrl();try{u=new URL(u).origin}catch(f){}let c=new URL(e,Dr);return c.searchParams.set("ctx",r),c.searchParams.set("cmp",i),c.searchParams.set("url",u),c}getUserTargetingUrl(e){let t=this._getBaseUrl("ids/pub.json");return e.includes("IDS")&&t.searchParams.set("ids","1"),t.href}getPageTargetingUrl(e,t){let r=this._getBaseUrl("bsc/pub.json");return r.searchParams.set("url",t),e.includes("BSC")&&r.searchParams.set("bsc","1"),e.includes("ABS")&&r.searchParams.set("abs","1"),e.includes("CBS")&&r.searchParams.set("cbs","1"),e.includes("CCT")&&r.searchParams.set("cct","1"),r.href}getSlotTargetingUrl(e,t){var u;let r=this._getBaseUrl("vlp/pub.json");e.includes("VLP")&&r.searchParams.set("vlp","1"),e.includes("TVP")&&r.searchParams.set("tvp","1");let i=0;for(let c of t){let{id:f,position:v,sizes:y}=(u=c.adUnit)!=null?u:{},C=f+Ke(v);r.searchParams.set(`slot-${i++}-${C}`,Gt(y))}return r.href}};o(F,"SignalsUrlBuilder"),F=l([p],F);var ce=class{constructor(){d(this,"cache",{})}_fetchFreshSignals(e,t){return T(this,null,function*(){if(!t.some($t))return{};let r=this.core.get(F).getPageTargetingUrl(t,e),i=yield this.core.get(k).fetchJson(r,{authToken:!0});return i instanceof Object?i:{}})}fetchSignals(e,t=3){return T(this,null,function*(){let r=this.core.get(P),i=r.getNormalizedPageUrl(),u=r.getStrippedPageUrl();this.cache[u]==null&&(this.cache[u]=this._fetchFreshSignals(i,e));let c=yield this.cache[u];return this.core.get(P).getStrippedPageUrl()!==u&&t>0?this.fetchSignals(e,t-1):c})}};o(ce,"PageSignals"),ce=l([p],ce);s();a();var ge=class{constructor(){d(this,"cache",{});d(this,"pendingSlots",[]);d(this,"pendingBulkRequest",null)}_scheduleBulkRequest(e){return T(this,null,function*(){yield Promise.resolve();let t=this.core.get(F).getSlotTargetingUrl(e,this.pendingSlots);this.pendingSlots=[],this.pendingBulkRequest=null;let r=yield this.core.get(k).fetchJson(t,{authToken:!0});return r instanceof Array?r:[]})}_fetchFreshSignals(e,t){return T(this,null,function*(){if(!t.some(kt))return{};let r=this.pendingSlots.push(e)-1;this.pendingBulkRequest==null&&(this.pendingBulkRequest=this._scheduleBulkRequest(t));let u=(yield this.pendingBulkRequest)[r];return u instanceof Object?u:{}})}_getCacheKey(e){var f,v;let{id:t,position:r,sizes:i}=(f=e.adUnit)!=null?f:{},u=t+Ke(r),c=(v=i==null?void 0:i.map(y=>{var C;return(C=y.label)!=null?C:`${y.width}x${y.height}`}).sort().join(","))!=null?v:"";return`${u}#${c}`}fetchSignals(e,t){return T(this,null,function*(){let r=this._getCacheKey(e);return this.cache[r]==null&&(this.cache[r]=this._fetchFreshSignals(e,t)),this.cache[r]})}};o(ge,"SlotSignals"),ge=l([p],ge);s();a();var me=class{constructor(){d(this,"cache")}_fetchFreshSignals(e){return T(this,null,function*(){if(!e.some(Ft))return{};let t=this.core.get(F).getUserTargetingUrl(e),r=yield this.core.get(k).fetchJson(t,{authToken:!0});return r instanceof Object?r:{}})}fetchSignals(e){return T(this,null,function*(){return this.cache==null&&(this.cache=this._fetchFreshSignals(e)),this.cache})}};o(me,"UserSignals"),me=l([p],me);var _=class{constructor(){d(this,"plugins",{getEnabledSignals:o(()=>[],"getEnabledSignals"),userTargetingUpdated:o(e=>[],"userTargetingUpdated"),pageTargetingUpdated:o(e=>[],"pageTargetingUpdated"),slotTargetingUpdated:o((e,t)=>[],"slotTargetingUpdated")});d(this,"dataForMigrationTracking",{userTargeting:{},pageTargeting:{},slotTargeting:new Map})}getEnabledSignals(){return this.plugins.getEnabledSignals()}getDataForMigrationTracking(){return this.dataForMigrationTracking}_initialize(){this.getUserTargeting(),this.getPageTargeting()}_onAdRequestQueued(){this.getPageTargeting()}_onSlotDiscovered(e){this.getSlotTargeting(e)}getUserTargeting(){return T(this,null,function*(){let e=this._fetchUserTargeting();return this.core.get(A).delayAdRequests(e),e})}getPageTargeting(){return T(this,null,function*(){let e=this._fetchPageTargeting();return this.core.get(A).delayAdRequests(e),e})}getSlotTargeting(e){return T(this,null,function*(){let t=this._fetchSlotTargeting(e);return this.core.get(A).delayAdRequests(t),t})}_fetchUserTargeting(){return T(this,null,function*(){let e=yield this.core.get(me).fetchSignals(this.getEnabledSignals());return this.core.get(w).setGlobalTargeting(e),this.dataForMigrationTracking.userTargeting=e,this.plugins.userTargetingUpdated(e),e})}_fetchPageTargeting(){return T(this,null,function*(){let e=yield this.core.get(ce).fetchSignals(this.getEnabledSignals());return this.core.get(w).setGlobalTargeting(e),this.dataForMigrationTracking.pageTargeting=e,this.plugins.pageTargetingUpdated(e),e})}_fetchSlotTargeting(e){return T(this,null,function*(){let t=yield this.core.get(ge).fetchSignals(e,this.getEnabledSignals());return this.core.get(w).setSlotTargeting(e,t),this.dataForMigrationTracking.slotTargeting.set(e,t),this.plugins.slotTargetingUpdated(e,t),t})}};o(_,"Signals"),l([b],_.prototype,"_initialize",1),l([h(A,"adRequestQueued")],_.prototype,"_onAdRequestQueued",1),l([h(R,"slotDiscovered")],_.prototype,"_onSlotDiscovered",1),_=l([p],_);s();a();var $=class{constructor(){d(this,"pq",null)}getPq(){return this.pq==null&&(this.pq=this._initialize()),this.pq}getPts(){let e=this.getPq();return e.PTS==null&&(e.PTS={}),e.PTS}setApi(e){let t=this.getPq();t!=null&&(t.init=()=>{},t.loadSignals=e.loadSignals,t.loadSignalsForSlots=e.loadSignalsForSlots,t.getTargeting=e.getTargeting)}_pushToDvtagCmd(...e){var r,i;let t=this.core.get(S).window();t.dvtag=(r=t.dvtag)!=null?r:{},t.dvtag.cmd=(i=t.dvtag.cmd)!=null?i:[],t.dvtag.cmd.push(...e)}_initialize(){var i,u;let e=this.core.get(S).window();e.PQ=(i=e.PQ)!=null?i:{};let t=e.PQ;if(t.loaded)return{cmd:[],PTS:{}};t.loaded=!0,t.PTS=(u=t.PTS)!=null?u:{};let r=t.cmd;return t.cmd={push:o(c=>this._pushToDvtagCmd(c),"push")},Array.isArray(r)&&this._pushToDvtagCmd(...r),t}};o($,"LegacyPq"),$=l([p],$);s();a();var jt=o(n=>{var r,i,u;let e=K(),t={id:(i=(r=n.adUnitPath)!=null?r:n.invCode)!=null?i:n.tagId,sizes:xe(Vt((u=n.sizes)!=null?u:"all")),position:n.position};return{elementId:e,adUnit:t}},"parseLegacyAdUnit");s();a();var Bt=o((n,e)=>{var i;let t=(i=n.IDS)==null?void 0:i[0];if(t==null)return;let r=parseInt(t);isNaN(r)||(e.IDS=r)},"setUserTargetingOnPts"),Qt=o((n,e)=>{for(let t of $e)n[t]!=null&&(e[t]=n[t])},"setPageTargetingOnPts"),zt=o((n,e,t)=>{var f,v,y,C,de,Le;let{adUnit:r}=n;if((r==null?void 0:r.id)==null)return;let i=r.id,u=pt((f=r.sizes)!=null?f:[]),c=r.position;for(let Q of Ve){let rt=e[Q];rt!=null&&((v=t[Q])!=null||(t[Q]={}),(C=(y=t[Q])[i])!=null||(y[i]={}),t[Q][i][u]=rt[0],c!=null&&((Le=(de=t[Q][i])[c])!=null||(de[c]={}),t[Q][i][c][u]=rt[0]))}},"setSlotTargetingOnPts");var Z=class{_initialize(){this.core.get($).setApi({loadSignals:this.loadSignals.bind(this),loadSignalsForSlots:this.loadSignalsForSlots.bind(this),getTargeting:this.getTargeting.bind(this)})}_setUserTargetingOnPts(e){let t=this.core.get($).getPts();Bt(e,t)}_setPageTargetingOnPts(e){let t=this.core.get($).getPts();Qt(e,t)}_setSlotTargetingOnPts(e,t){let r=this.core.get($).getPts();zt(e,t,r)}loadSignals(e,t){return T(this,null,function*(){yield this._onDvtagReady("loadSignals",t)})}loadSignalsForSlots(e,t,r){return T(this,null,function*(){let i=this.core.get(_),u=this.core.get(R);for(let f of e){let v=f.getSlotElementId(),y=u.getSlot("gpt",v);if(y==null){let C=this.core.get(X).getAdPositionKey(f.getAdUnitPath());y=u.createSlot("gpt",0,v,He(f,C))}i.getSlotTargeting(y)}let c=typeof t=="function"?t:r;yield this._onDvtagReady("loadSignalsForSlots",c)})}getTargeting(e,t){return T(this,null,function*(){var c;let r=this.core.get(_),i=this.core.get(R);for(let f of(c=e.adUnits)!=null?c:[]){let{elementId:v,adUnit:y}=jt(f),C=i.createSlot("legacy-api",0,v,y);r.getSlotTargeting(C)}let u=o(()=>t==null?void 0:t(void 0,this.core.get($).getPts()),"callback");yield this._onDvtagReady("getTargeting",u)})}_getPubAdsTargeting(e){var t,r,i;return(i=(r=(t=this.core.get(S).window().googletag)==null?void 0:t.pubads)==null?void 0:r.call(t).getTargeting(e))!=null?i:[]}_onDvtagReady(e,t){return T(this,null,function*(){yield new Promise(r=>{this.core.get(S).window().dvtag.queueAdRequest({callback:o(()=>{try{t==null||t()}catch(i){}r()},"callback"),timestamp:new Date().getTime(),timeout:750,internal:!0})})})}};o(Z,"LegacyLayer"),l([b],Z.prototype,"_initialize",1),l([h(_,"userTargetingUpdated")],Z.prototype,"_setUserTargetingOnPts",1),l([h(_,"pageTargetingUpdated")],Z.prototype,"_setPageTargetingOnPts",1),l([h(_,"slotTargetingUpdated")],Z.prototype,"_setSlotTargetingOnPts",1),Z=l([p],Z);s();a();var ye=class{_getEnabledSignals(){return"IDS"}};o(ye,"SignalsIds"),l([h(_,"getEnabledSignals")],ye.prototype,"_getEnabledSignals",1),ye=l([p],ye);s();a();var Ee=class{_getEnabledSignals(){return"BSC"}};o(Ee,"SignalsBsc"),l([h(_,"getEnabledSignals")],Ee.prototype,"_getEnabledSignals",1),Ee=l([p],Ee);s();a();var Re=class{_getEnabledSignals(){return"VLP"}};o(Re,"SignalsVlp"),l([h(_,"getEnabledSignals")],Re.prototype,"_getEnabledSignals",1),Re=l([p],Re);s();a();var Ae=class{_getEnabledSignals(){return"TVP"}};o(Ae,"SignalsTvp"),l([h(_,"getEnabledSignals")],Ae.prototype,"_getEnabledSignals",1),Ae=l([p],Ae);s();a();var _e=class{_getEnabledSignals(){return"ABS"}};o(_e,"SignalsAbs"),l([h(_,"getEnabledSignals")],_e.prototype,"_getEnabledSignals",1),_e=l([p],_e);s();a();var we=class{_getEnabledSignals(){return"CBS"}};o(we,"SignalsCbs"),l([h(_,"getEnabledSignals")],we.prototype,"_getEnabledSignals",1),we=l([p],we);s();a();s();a();s();a();s();a();var ae=class{constructor(){d(this,"plugins",{adRemoved:o(e=>[],"adRemoved")})}_monitorAdRemoval(e){let t=this.core.get(S).document().getElementById(e.elementId);if(t==null)return;E.Create({parent:e,observer:new MutationObserver(i=>{let u=i.length,c=0,f=t.children.length;for(let v=i.length-1;v>=0;v--){let y=i[v];if(f===0){this.plugins.adRemoved(e);break}if(c===u-1)break;let C=y.removedNodes.length-y.addedNodes.length;f+=C,c++}})},({parent:i,observer:u})=>{u.disconnect(),this.plugins.adRemoved(i)}).observer.observe(t,{childList:!0})}};o(ae,"AdRemoved"),l([h(R,"slotDiscovered")],ae.prototype,"_monitorAdRemoval",1),ae=l([p],ae);var D=class{constructor(){d(this,"adEmpty",new E.Map);d(this,"adRequestInFlight",new E.Map);d(this,"nonEmptyAdResponses",new E.Map);d(this,"creatives",new E.Link);d(this,"plugins",{adRequested:o(e=>[],"adRequested"),adRequestedOrInferred:o(e=>[],"adRequestedOrInferred"),adRendered:o((e,t)=>[],"adRendered"),adRemoved:o(e=>[],"adRemoved")})}setAdRequested(e){this.adRequestInFlight.set(e,!0),this.plugins.adRequested(e),this.plugins.adRequestedOrInferred(e)}setAdRendered(e,t){this.adRequestInFlight.get(e)!==!0&&this.plugins.adRequestedOrInferred(e),this._setAdRemoved(e),this.adEmpty.set(e,!1),this.adRequestInFlight.set(e,!1),t!=null&&this.nonEmptyAdResponses.set(e,this.nonEmptyAdResponses.summon(e,0)+1);let r=null;if(t!=null){let i=this.core.get(S).time();r=E.Create(M({parent:e,timestamp:i},t)),this.creatives.get(e).add(r)}this.plugins.adRendered(e,r)}_setAdRemoved(e){if(this.adEmpty.get(e)===!1){this.adEmpty.set(e,!0);for(let t of this.creatives.get(e))t.destroy();this.plugins.adRemoved(e)}}getNonEmptyAdRenderedCount(e){return this.nonEmptyAdResponses.summon(e,0)}};o(D,"AdServerHub"),l([h(ae,"adRemoved")],D.prototype,"_setAdRemoved",1),D=l([p],D);s();a();s();a();var Je=o(n=>{if(typeof n=="string"||Array.isArray(n)&&n.length===2&&n.every(e=>typeof e=="number"))return n;if(n!=null&&typeof n.width=="number"&&typeof n.height=="number")return[n.width,n.height]},"cleanSizeInput");s();a();var U=o(n=>{if(typeof n=="string")return n;if(typeof n=="number")return`${n}`},"cleanStringInput");s();a();var V=class{getPubAds(){var t,r;let e=this.core.get(S).window();try{return(r=(t=e.googletag)==null?void 0:t.pubads)==null?void 0:r.call(t)}catch(i){return}}onPubAdsReady(e){var i,u,c,f;let t=this.core.get(S).window();t.googletag=(i=t.googletag)!=null?i:{},t.googletag.cmd=(u=t.googletag.cmd)!=null?u:[];let r=this.getPubAds();if(r!=null)e(r);else try{(f=(c=t.googletag.cmd)==null?void 0:c.push)==null||f.call(c,()=>{r=this.getPubAds(),r!=null&&e(r)})}catch(v){}}};o(V,"GoogletagPubAds"),V=l([p],V);s();a();var q=class{constructor(){d(this,"gptReference",new E.Map)}_scanForSlots(){this.core.get(V).onPubAdsReady(e=>{e.getSlots().map(t=>this.maybeDiscoverSlot(t,0))})}getGptSlot(e){return this.gptReference.get(e)}maybeDiscoverSlot(e,t){let r=this.core.get(R).getSlot("gpt",e.getSlotElementId());return r==null||this.gptReference.get(r)!==e?this._createSlot(e,t):r}_createSlot(e,t){let r=e.getSlotElementId(),i=e.getAdUnitPath(),u=Ye(i),c=this.core.get(X).getAdPositionKey(u),f=He(e,c);return this.core.get(R).createSlot("gpt",t,r,f,y=>this.gptReference.set(y,e))}};o(q,"GoogletagSlots"),l([b,h(A,"adRequestQueued")],q.prototype,"_scanForSlots",1),q=l([p],q);var ee=class{constructor(){d(this,"plugins",{adRequested:o(e=>[],"adRequested"),adRendered:o((e,t)=>[],"adRendered")})}_getHtmlSafe(e){var t,r;try{return(r=(t=e.getHtml)==null?void 0:t.call(e))!=null?r:void 0}catch(i){return}}_initialize(){this.core.get(V).onPubAdsReady(e=>{e.addEventListener("slotRequested",t=>{let r=this.core.get(q).maybeDiscoverSlot(t.slot,1);this.plugins.adRequested(r)}),e.addEventListener("slotRenderEnded",t=>{let r=this.core.get(q).maybeDiscoverSlot(t.slot,2);if(t.isEmpty){this.plugins.adRendered(r,null);return}let i={type:"display",advertiserId:U(t.advertiserId),campaignId:U(t.campaignId),creativeId:U(t.creativeId),lineItemId:U(t.lineItemId),renderedSize:Je(t.size),html:this._getHtmlSafe(t.slot)};this.plugins.adRendered(r,i)})})}};o(ee,"GoogletagEvents"),l([b],ee.prototype,"_initialize",1),ee=l([p],ee);s();a();s();a();var ft=o(n=>typeof n=="string"||typeof n=="number"?[`${n}`]:n instanceof Array?se(n.filter(e=>typeof e=="string"||typeof e=="number").map(e=>`${e}`)):[],"cleanTargetingInput");var le=class{getAdServerTargeting(e,t){var u,c,f;if(e.adServer!=="gpt")return[];let r=[];try{r=ft((c=(u=this.core.get(V).getPubAds())==null?void 0:u.getTargeting)==null?void 0:c.call(u,t))}catch(v){}let i=[];try{i=ft((f=this.core.get(q).getGptSlot(e))==null?void 0:f.getTargeting(t))}catch(v){}return se(r,i)}setAdServerTargeting(e,t,r){var i;if(e.adServer==="gpt")try{(i=this.core.get(q).getGptSlot(e))==null||i.setTargeting(t,r)}catch(u){}}};o(le,"GoogletagTargeting"),le=l([p],le);var G=class{_onAdRequested(e){this.core.get(D).setAdRequested(e)}_onAdRendered(e,t){this.core.get(D).setAdRendered(e,t)}_getAdServerTargeting(e,t){return e.adServer!=="gpt"?[]:this.core.get(le).getAdServerTargeting(e,t)}_setAdServerTargeting(e,t,r){e.adServer==="gpt"&&this.core.get(le).setAdServerTargeting(e,t,r)}};o(G,"Googletag"),l([h(ee,"adRequested")],G.prototype,"_onAdRequested",1),l([h(ee,"adRendered")],G.prototype,"_onAdRendered",1),l([h(w,"getAdServerTargeting")],G.prototype,"_getAdServerTargeting",1),l([h(w,"setAdServerTargeting")],G.prototype,"_setAdServerTargeting",1),G=l([p],G);s();a();s();a();var Yt=o((n,e=!0)=>{let t=document.createElement("script");return t.setAttribute("src",n),e&&t.setAttribute("async",""),t},"createScriptElement");s();a();s();a();var pe=o(()=>{var n,e,t;return Math.floor((t=(e=(n=window.performance)==null?void 0:n.now)==null?void 0:e.call(n))!=null?t:Date.now())},"perfNowOrDateNow");s();a();var ht=class ht{constructor(){d(this,"_firstQueuedAdRequest",1/0);d(this,"_lastQueuedAdRequest",-1/0);d(this,"_firstReleasedAdRequest",1/0);d(this,"_lastReleasedAdRequest",-1/0);d(this,"_lastReleasedAdRequestTime",null);d(this,"_hasBeenSuccessful",!1)}setAdRequestQueued(e){this._firstQueuedAdRequest=Math.min(this._firstQueuedAdRequest,e),this._lastQueuedAdRequest=Math.max(this._lastQueuedAdRequest,e)}setAdRequestReleased(e){this._firstReleasedAdRequest=Math.min(this._firstReleasedAdRequest,e),this._lastReleasedAdRequest=Math.max(this._lastReleasedAdRequest,e),this._lastReleasedAdRequestTime=pe()}getLastQueuedAdRequest(){return Number.isFinite(this._lastQueuedAdRequest)?this._lastQueuedAdRequest:null}getLastReleasedAdRequest(){return Number.isFinite(this._lastReleasedAdRequest)?this._lastReleasedAdRequest:null}getLastReleasedAdRequestTime(){return this._lastReleasedAdRequestTime}getLastSuccessfulAdRequest(){let e=Math.max(this._firstQueuedAdRequest,this._firstReleasedAdRequest),t=Math.min(this._lastQueuedAdRequest,this._lastReleasedAdRequest);return t<e?null:t}getPreviouslySuccessful(){return this._hasBeenSuccessful}markAdServerAdRequest(){this.getLastSuccessfulAdRequest()!=null&&(this._hasBeenSuccessful=!0),this._firstQueuedAdRequest=1/0,this._lastQueuedAdRequest=-1/0,this._firstReleasedAdRequest=1/0,this._lastReleasedAdRequest=-1/0,this._lastReleasedAdRequestTime=null}};o(ht,"SlotAdRequestTracker");var Ze=ht;s();a();var et=(c=>(c.UNKNOWN="UNKNOWN",c.SEEN="SEEN",c.NOT_READY="NOT_READY",c.POSSIBLE_TIMEOUT="POSSIBLE_TIMEOUT",c.PREV_READY="PREV_READY",c.READY="READY",c))(et||{});var vt="dv_upt_slot_ready",Ir=["https://securepubads.g.doubleclick.net/gampad/ads?","https://pagead2.googlesyndication.com/gampad/ads?"],Or=750,O=class{constructor(){d(this,"plugins",{onSlotRequested:o(()=>[],"onSlotRequested"),onSlotRequestValidated:o(()=>[],"onSlotRequestValidated")});d(this,"validateAdRequests",!1);d(this,"lastAdRequestQueued",null);d(this,"lastAdRequestReleased",null);d(this,"state",{adRequestTracker:new E.Map,triggered:new E.Map})}_getSlotAdRequestTracker(e){return this.state.adRequestTracker.conjure(e,()=>new Ze)}_onAdRequestQueued({index:e}){this.lastAdRequestQueued=e;for(let t of this.core.get(R).getSlots())this._getSlotAdRequestTracker(t).setAdRequestQueued(e),this.state.triggered.set(t,!1)}_onAdRequestBeforeRelease({index:e}){let t=this.core.get(w);this.lastAdRequestReleased=e;for(let r of this.core.get(R).getSlots())this._getSlotAdRequestTracker(r).setAdRequestReleased(e),this.validateAdRequests&&t.setSlotTargeting(r,{[vt]:["1"]})}_onSlotDiscovered(e,t){t===0&&this.lastAdRequestQueued!=null&&this._getSlotAdRequestTracker(e).setAdRequestQueued(this.lastAdRequestQueued)}_determineReadyState(e){let t=this._getSlotAdRequestTracker(e),r=t.getLastQueuedAdRequest(),i=t.getLastSuccessfulAdRequest(),u=t.getPreviouslySuccessful();return i!=null?"READY":u?"PREV_READY":r!=null?"NOT_READY":Date.now()-e.creationTime>Or?"SEEN":"UNKNOWN"}getSlotReadyStateOnAdServerAdRequest(e){let t=this._determineReadyState(e);if(t==="READY"){if(this.state.triggered.get(e)===!0)return{readyState:"PREV_READY"};this.state.triggered.set(e,!0);let r=this._getSlotAdRequestTracker(e).getLastReleasedAdRequestTime();return{readyState:t,readyFor:pe()-r}}return{readyState:t}}_onSlotRequested(e){let{readyState:t,readyFor:r}=this.getSlotReadyStateOnAdServerAdRequest(e);this._getSlotAdRequestTracker(e).markAdServerAdRequest(),this.validateAdRequests&&this.core.get(w).setSlotTargeting(e,{[vt]:["0"]}),this.plugins.onSlotRequested(e,t,r)}enableAdRequestValidation(){if(!this.validateAdRequests)try{let e=this._processResourceRequest.bind(this);new PerformanceObserver(r=>r.getEntries().forEach(e)).observe({type:"resource"}),this.validateAdRequests=!0}catch(e){}}_processResourceRequest(e){var t,r,i;try{if(Ir.every(f=>!e.name.startsWith(f)))return;let c=(r=(t=new URL(e.name).searchParams.get("prev_scp"))==null?void 0:t.split("|"))!=null?r:[];for(let f of c){let y=((i=new URLSearchParams(f).get(vt))==null?void 0:i[0])==="1";this.plugins.onSlotRequestValidated(y)}}catch(u){}}};o(O,"SlotReadinessTracker"),l([h(A,"adRequestQueued")],O.prototype,"_onAdRequestQueued",1),l([h(A,"adRequestBeforeRelease"),h(A,"adRequestTimedOut")],O.prototype,"_onAdRequestBeforeRelease",1),l([h(R,"slotDiscovered")],O.prototype,"_onSlotDiscovered",1),l([h(D,"adRequested")],O.prototype,"_onSlotRequested",1),O=l([p],O);var St="__dvtag_debug_mode",Ht="1",j=class{constructor(){d(this,"enabled",!1);d(this,"debugScriptLoaded",o(e=>{},"debugScriptLoaded"));d(this,"debugScriptLoadedPromise",new Promise(e=>{this.debugScriptLoaded=e}))}_initialize(){let e=this.core.get(S).window();try{this.enabled=e===e.top&&e.sessionStorage.getItem(St)===Ht}catch(t){}this.enabled&&(this.core.get(A).delayAdRequests(this.debugScriptLoadedPromise),this._loadDebugScript())}_toggleDebugMode(){let e=this.core.get(S).window();this.enabled?e.sessionStorage.removeItem(St):e.sessionStorage.setItem(St,Ht),e.location.reload()}_onDebugScriptLoaded(){this.debugScriptLoaded(void 0)}_loadDebugScript(){return T(this,null,function*(){let{ctx:e,cmp:t}=this.core.get(P).getTagInfo(),r=this.core.get(S).document(),i=Yt(`https://pub.doubleverify.com/dvtag/${e}/${t}/debug.js`,!0);r.readyState==="loading"&&(yield new Promise(u=>r.addEventListener("DOMContentLoaded",()=>u(void 0)))),r.head.appendChild(i)})}_onAdRequestEvent(e){var t;(t=window.dvtagDebug)==null||t.adRequestEvent(e)}};o(j,"DebugScriptLoader"),l([b],j.prototype,"_initialize",1),l([h(I,"toggleDebugMode")],j.prototype,"_toggleDebugMode",1),l([h(I,"_debugScriptLoaded")],j.prototype,"_onDebugScriptLoaded",1),l([h(A,"adRequestQueued"),h(A,"adRequestBeforeRelease"),h(A,"adRequestTimedOut")],j.prototype,"_onAdRequestEvent",1),j=l([N(O),p],j);s();a();var Tt="qt_loaded",Wt="pts_pid";s();a();var yt=o(n=>[...new Set(n.filter(qt).map(e=>e.toLowerCase()))],"getGreenlightSignal");var fe=class{_autoInsertGlobalTargeting(e){this.core.get(w).setGlobalTargeting({[Tt]:yt(Object.keys(e))},!0)}_autoInsertSlotTargeting(e,t){this.core.get(w).setSlotTargeting(e,{[Tt]:yt(Object.keys(t))},!0)}};o(fe,"SignalsAutoInsertion"),l([h(_,"userTargetingUpdated"),h(_,"pageTargetingUpdated")],fe.prototype,"_autoInsertGlobalTargeting",1),l([h(_,"slotTargetingUpdated")],fe.prototype,"_autoInsertSlotTargeting",1),fe=l([p,N(G),N(j)],fe);s();a();s();a();s();a();var Nr=126,Lr=20,Mr=250,ue=class{constructor(){d(this,"firstResultPromise",new E.Map);d(this,"consent",new E.Map)}getConsent(){return M({},this.consent.conjure(this.core.session,()=>({apiAvailable:!1,applies:"",tcString:""})))}getConsentAsync(){return T(this,null,function*(){return yield this._getConsentPromise(),this.getConsent()})}_getConsentPromise(){return T(this,null,function*(){return this.firstResultPromise.conjure(this.core.session,()=>this._monitorConsent()).catch(()=>{})})}_monitorConsent(){return T(this,null,function*(){let e=yield this._getTcfApiAsync();e!=null&&(yield new Promise(t=>{try{e("addEventListener",2,(r,i)=>{i===!0&&this._setConsent(r),t()},[Nr])}catch(r){t()}}))})}_getTcfApiAsync(){return T(this,null,function*(){let e=this.core.get(S).window(),t=this._getTcfApi(),r=0;for(;t==null&&r<Lr;)r++,yield new Promise(i=>e.setTimeout(i,Mr)),t=this._getTcfApi();return t})}_getTcfApi(){let t=this.core.get(S).window().__tcfapi;if(typeof t=="function")return t}_setConsent(e){let t;e.gdprApplies===!0||e.gdprApplies===1?t="1":e.gdprApplies===!1||e.gdprApplies===0?t="0":t="";let r=typeof e.tcString=="string"?e.tcString:"";this.consent.set(this.core.session,{apiAvailable:!0,applies:t,tcString:r})}};o(ue,"GdprConsent"),l([b],ue.prototype,"_getConsentPromise",1),ue=l([p],ue);s();a();var Ur="https://vtrk.doubleverify.com",Kt="dvtag",qr=1,L=class{constructor(){d(this,"sharedDataPoints")}_onAdRequestCompleted(e){if(e.index!==0)return;let{timeoutValue:t,onDvtagReadyCalled:r,callbackCalled:i}=e,u=i!=null?i-r:t,{applies:c,apiAvailable:f}=this.core.get(ue).getConsent();this.fireEvent("ad-request",{cd111:e.status,cm106:e.index,cm107:u,cd112:e.internal?"legacy":"modern",cd115:c,cm116:f?1:0},{sampleInterval:qr})}_getSharedDataPoints(){if(this.sharedDataPoints==null){let e=this.core.get(P),t=this.core.get(J),r=this.core.get(S),{ctx:i,cmp:u,legacy:c}=e.getTagInfo(),f=r.hostname(),v=e.getSessionUuid(),y=t.getShortCommitId();this.sharedDataPoints={cd102:y,cd103:"",cd107:v,cd109:c?"legacy":"modern",cd108:"",cd105:i,cd106:u,cd104:f}}return this.sharedDataPoints}fireEvent(e,t,{sampleInterval:r=1,trackerUuid:i=K(),spoofWrapperId:u=!1}={}){if(Math.random()>=1/r)return;t=Ue(M(M({},t),this._getSharedDataPoints()),{cd101:e,cm101:r});let c=Ue(M({ec:Kt,ea:t.cd101,ctx:u?Kt:t.cd105,cmp:t.cd106},t),{cid:i,t:"event",v:1,z:i,cd160:i}),f=new URL(Ur);for(let[v,y]of Object.entries(c))y!=null&&f.searchParams.set(v,`${y}`);this.core.get(S).sendBeacon(f.href)}};o(L,"Events"),l([h(A,"adRequestCompleted")],L.prototype,"_onAdRequestCompleted",1),L=l([p],L);s();a();var te=class{constructor(){d(this,"renderCount",0)}_onAdRendered(){this.renderCount+=1}reset(){this.renderCount=0}getRenderCount(){return this.renderCount}};o(te,"AdRenderedCounter"),l([h(D,"adRendered")],te.prototype,"_onAdRendered",1),te=l([p],te);s();a();var er=vr(Jt());s();a();var Et=class Et{constructor(e){d(this,"arr");d(this,"start");d(this,"size");this.arr=new Array(e),this.start=0,this.size=0}push(e){this.size===this.arr.length?this.start=this.nthIndex(1):this.size+=1,this.arr[this.nthIndex(this.size-1)]=e}nthIndex(e){return(this.start+e)%this.arr.length}last(){return this.size===0?null:this.arr[this.nthIndex(this.size-1)]}findNewest(e){for(let t=this.size-1;t>=0;t--){let r=this.arr[this.nthIndex(t)];if(e(r))return r}return null}};o(Et,"RingBuffer");var tt=Et;var Zt=10,Fr=100,$r=3e3,Vr=2e3,Y=class{constructor(){d(this,"measurements",new tt(20));d(this,"lastNavigationTime");d(this,"viewportWidths",new Set);d(this,"documentHeights",new Set)}_initialize(){return T(this,null,function*(){let{document:e}=this.core.get(S).window();e.readyState==="loading"&&(yield new Promise(t=>e.addEventListener("DOMContentLoaded",()=>t(void 0)))),e.addEventListener("scroll",(0,er.default)(()=>{this._updateScrollMetrics()},200)),this._updateScrollMetrics()})}_getScrollData(){let e=this.core.get(S).document().compatMode==="BackCompat",{scrollHeight:t,clientHeight:r,clientWidth:i}=this.core.get(S).window().document[e?"body":"documentElement"];return{scrollY:Math.floor(this.core.get(S).window().scrollY),viewportHeight:r,viewportWidth:i,documentHeight:t}}_getScrollPercentage({scrollY:e,documentHeight:t,viewportHeight:r}){return t===r?0:e/(t-r)}_updateScrollMetrics(e=!1){var v;let t=this._getScrollData(),r=this.lastNavigationTime!=null&&Date.now()-this.lastNavigationTime<$r;this.viewportWidths.size<Zt&&this.viewportWidths.add(t.viewportWidth),this.documentHeights.size<Zt&&this.documentHeights.add(t.documentHeight);let{deepestScrollData:i,deepestScrollWithResetData:u,maxScrollData:c,hasScrolledToTop:f}=(v=this.measurements.last())!=null?v:{};f=!e&&f===!0||t.scrollY<t.viewportHeight,(c==null||r||t.scrollY>=c.scrollY)&&(c=t),(i==null||r||this._getScrollPercentage(t)>=this._getScrollPercentage(i))&&(i=t),(u==null||r||this._getScrollPercentage(t)>=this._getScrollPercentage(u)||t.documentHeight-u.documentHeight>Fr)&&(u=t),this.measurements.push({time:Date.now(),hasScrolledToTop:f,maxScrollData:c,deepestScrollData:i,deepestScrollWithResetData:u})}getScrollMeasurements(e){var r;let t;return e==null?t=this.measurements.last():t=(r=this.measurements.findNewest(i=>i.time<Date.now()-e))!=null?r:this.measurements.last(),t==null?null:Ue(M({},t),{viewportWidths:this.viewportWidths,documentHeights:this.documentHeights})}reset(){this.lastNavigationTime=Date.now(),this._updateScrollMetrics(!0),setTimeout(()=>this._updateScrollMetrics(),Vr)}};o(Y,"ScrollMetrics"),l([b],Y.prototype,"_initialize",1),Y=l([p],Y);s();a();s();a();var tr=o((n,{deepestScrollData:e,deepestScrollWithResetData:t,maxScrollData:r,viewportWidths:i,documentHeights:u},{inFocusMs:c,visibleMs:f,visibleAndInFocusMs:v},y,C,de)=>{var Q;let Le=(Q=performance==null?void 0:performance.now)==null?void 0:Q.call(performance);return{cd110:n.visit.normalizedUrl,cd111:[...i].join(","),cd112:[...u].join(","),cd113:n.visit.uuid,cm106:c,cm107:f,cm108:C,cm109:de,cm110:n.visitIndex,cm111:n.infiniteScrollDetected?1:0,cm116:Le!=null?Le/1e3:void 0,cm117:v,cm118:n.visitStart/1e3,cm119:Date.now()/1e3,cm120:n.trackerCount,cm121:e.scrollY,cm122:e.viewportHeight,cm123:e.viewportWidth,cm124:e.documentHeight,cm125:t.scrollY,cm126:t.viewportHeight,cm127:t.viewportWidth,cm128:t.documentHeight,cm129:r.scrollY,cm130:r.viewportHeight,cm131:r.viewportWidth,cm132:r.documentHeight,cm133:y}},"createPlemTracker");s();a();s();a();var Rt=class Rt{constructor(){d(this,"runningSince",null);d(this,"totalTimeMs",0)}getTimestamp(){return Date.now()}getCurrentRunningTime(){return this.runningSince!=null?this.getTimestamp()-this.runningSince:0}start(){this.runningSince=this.getTimestamp()}stop(){this.totalTimeMs+=this.getCurrentRunningTime(),this.runningSince=null}add(e){this.totalTimeMs+=e}get(){return this.totalTimeMs+this.getCurrentRunningTime()}reset(e=!1){this.runningSince=this.runningSince!=null&&e?Date.now():null,this.totalTimeMs=0}};o(Rt,"Timer");var Ie=Rt;var re=class{constructor(){d(this,"inFocusTimer",new Ie);d(this,"visibleTimer",new Ie);d(this,"visibleInFocusTimer",new Ie)}_initialize(){return T(this,null,function*(){var r,i,u;let e=this.core.get(S).window(),t=(u=(i=(r=e.performance)==null?void 0:r.now)==null?void 0:i.call(r))!=null?u:0;e.addEventListener("focus",()=>{this.inFocusTimer.start(),e.document.hidden||this.visibleInFocusTimer.start()}),e.addEventListener("blur",()=>{this.inFocusTimer.stop(),this.visibleInFocusTimer.stop()}),e.document.addEventListener("visibilitychange",()=>{e.document.hidden?(this.visibleTimer.stop(),this.visibleInFocusTimer.stop()):(this.visibleTimer.start(),e.document.hasFocus()&&this.visibleInFocusTimer.start())}),e.document.hasFocus()&&(this.inFocusTimer.add(t),this.inFocusTimer.start(),e.document.hidden||(this.visibleInFocusTimer.add(t),this.visibleInFocusTimer.start())),e.document.hidden||(this.visibleTimer.add(t),this.visibleTimer.start())})}getVisibilityMeasurements(){return{inFocusMs:this.inFocusTimer.get(),visibleMs:this.visibleTimer.get(),visibleAndInFocusMs:this.visibleInFocusTimer.get()}}reset(){this.visibleTimer.reset(!0),this.inFocusTimer.reset(!0),this.visibleInFocusTimer.reset(!0)}};o(re,"VisibilityMetrics"),l([b],re.prototype,"_initialize",1),re=l([p],re);var Gr=6e4,jr=61*60*1e3,Br=59.5*60*1e3,Qr=6e4,zr=2500,Yr=5e3,Hr=1500,he=class{constructor(){d(this,"currVisit");d(this,"pendingTracker");d(this,"tagLoadTime");d(this,"firstContentfulPaint")}_initialize(){return T(this,null,function*(){var t,r;let e=this.core.get(S).window();this.tagLoadTime=(r=(t=e.performance)==null?void 0:t.now)==null?void 0:r.call(t),this._updateFirstContentfulPaint(),e.document.addEventListener("visibilitychange",()=>{e.document.hidden&&this._flushTrackers()}),setInterval(()=>{this.currVisit!=null&&Date.now()>this.currVisit.visitStart+Br&&(e.document.hidden||this._fireTracker())},Qr)})}_updateFirstContentfulPaint(){let e=this.core.get(S).window().PerformanceObserver;try{let t=new e(r=>{r.getEntries().forEach(i=>{i.name==="first-contentful-paint"&&(this.firstContentfulPaint=i.startTime,t.disconnect())})});t.observe({type:"paint",buffered:!0})}catch(t){}}_fireTracker({visit:e,scroll:t,visibility:r,adRenderCount:i}=this._getTrackerData(),u=!1){t!=null&&(!u&&(Date.now()>e.visitStart+jr||e.lastTrackerTime!=null&&e.lastTrackerTime>Date.now()-Gr)||(this.core.get(L).fireEvent("content-metrics",tr(e,t,r,i,this.tagLoadTime,this.firstContentfulPaint),{sampleInterval:1,spoofWrapperId:!0}),e.lastTrackerTime=Date.now(),e.trackerCount+=1))}_getTrackerData(){if(this.currVisit==null)throw new Error("No data!");return{visit:this.currVisit,scroll:this.core.get(Y).getScrollMeasurements(Hr),visibility:this.core.get(re).getVisibilityMeasurements(),adRenderCount:this.core.get(te).getRenderCount()}}_checkForInfiniteScroll(){let e=this.core.get(Y).getScrollMeasurements();e!=null&&!e.hasScrolledToTop&&(this.pendingTracker!=null&&(this.pendingTracker.data.visit.infiniteScrollDetected=!0),this.currVisit!=null&&(this.currVisit.infiniteScrollDetected=!0))}_scheduleDelayedTracker(){this._flushPendingTracker(),this.pendingTracker={data:this._getTrackerData(),timer:setTimeout(()=>{this._flushPendingTracker()},Yr)}}_flushPendingTracker(){this.pendingTracker!=null&&(this._checkForInfiniteScroll(),this._fireTracker(this.pendingTracker.data,!0),clearTimeout(this.pendingTracker.timer),this.pendingTracker=void 0)}_flushTrackers(){this._flushPendingTracker(),this._fireTracker()}_onNewVisit(e){var r,i;let t=this.currVisit==null;this.currVisit!=null&&(Date.now()-this.currVisit.visitStart>zr&&this._scheduleDelayedTracker(),this.core.get(re).reset(),this.core.get(Y).reset(),this.core.get(te).reset()),this.currVisit={visit:e,visitStart:Date.now()-(t&&this.tagLoadTime!=null?this.tagLoadTime:0),visitIndex:((i=(r=this.currVisit)==null?void 0:r.visitIndex)!=null?i:-1)+1,trackerCount:0}}};o(he,"PLEMetrics"),l([b],he.prototype,"_initialize",1),l([h(P,"newVisit")],he.prototype,"_onNewVisit",1),he=l([p],he);s();a();s();a();var Wr=Wt,H=class{constructor(){d(this,"restoreCount",0)}getRestoreCount(){return this.restoreCount}_restoreTargeting(){let e=this.core.get(w);for(let t of this.core.get(R).getSlots())e.getAdServerTargeting(t,Wr).length===0&&(e.setAdServerTargeting(t),this.restoreCount+=1)}};o(H,"TargetingRestorer"),l([h(A,"adRequestQueued")],H.prototype,"_restoreTargeting",1),H=l([p],H);s();a();var At=class At{constructor(){d(this,"total",0);d(this,"dataPoints",0)}push(e){return this.total+=e,this.dataPoints+=1,this}get(){return this.total/this.dataPoints}getRounded(){return Math.round(this.get())}};o(At,"Average");var je=At;var Kr="implcheck",Xr=1e-4,Jr=5e3,Zr=5,B=class{constructor(){d(this,"enabled",!1);d(this,"totalInternalAdRequestQueuedCount",0);d(this,"totalAdRequestsCompletedCount",0);d(this,"totalSlotsRequestedCount",0);d(this,"totalSlotsRequestedOkCount",0);d(this,"totalTimeoutCount",0);d(this,"trackersSent",0);d(this,"totalValidatedAdServerRequests",{ok:0,notOk:0});d(this,"lastOnDvtagReadyCall",NaN);d(this,"slotReqAvgTimeSinceCall",new je);d(this,"slotReqAvgTimeSinceDone",new je);d(this,"batch",null)}isDebugForceEnabled(){return!1}_initialize(){this.enabled=this.core.get(B).isDebugForceEnabled()||Math.random()<Xr,this.enabled&&this.core.get(O).enableAdRequestValidation()}_onAdRequestQueued(e){this.enabled&&(this.lastOnDvtagReadyCall=pe(),e.internal&&(this.totalInternalAdRequestQueuedCount+=1))}_onAdRequestCompleted(e){this.enabled&&(this.totalAdRequestsCompletedCount+=1,(e.status==="tag-timeout"||e.status==="queue-timeout")&&(this.totalTimeoutCount+=1))}_onSlotRequested(e,t,r){if(!this.enabled)return;let i=this._getOrStartBatch();this.totalSlotsRequestedCount+=1,t==="READY"&&(this.totalSlotsRequestedOkCount+=1),i.slots[t].push(e.elementId),r!=null&&(this.slotReqAvgTimeSinceDone.push(r),this.slotReqAvgTimeSinceCall.push(pe()-this.lastOnDvtagReadyCall));let u=this._validateAdServerTargeting(e);u===1?i.targeting.extendedCount+=1:u===0&&(i.targeting.reducedCount+=1)}_validateAdServerTargeting(e){let t=this.core.get(w),r=2,i=t.getTargeting(e);for(let[u,c]of Object.entries(i)){let f=t.getAdServerTargeting(e,u);if(c.length>f.length||c.some(v=>!f.includes(v)))return 0;f.length>c.length&&(r=1)}return r}_onSlotRequestValidated(e){e?this.totalValidatedAdServerRequests.ok+=1:this.totalValidatedAdServerRequests.notOk+=1}_sendTracker(){let e=this.core.get(H).getRestoreCount(),{slots:t,targeting:r,start:i}=this._getOrStartBatch(),u={cd110:t.READY.join(),cd111:t.PREV_READY.join(),cd112:t.SEEN.join(),cd113:t.NOT_READY.join(),cd114:t.UNKNOWN.join(),cd115:t.POSSIBLE_TIMEOUT.join(),cm106:this.trackersSent,cm107:i,cm109:this.totalTimeoutCount,cm110:this.slotReqAvgTimeSinceCall.getRounded(),cm111:this.slotReqAvgTimeSinceDone.getRounded(),cm112:this.totalSlotsRequestedOkCount,cm113:this.totalValidatedAdServerRequests.ok,cm114:this.totalValidatedAdServerRequests.notOk,cm115:e,cm116:this.totalAdRequestsCompletedCount,cm117:this.totalInternalAdRequestQueuedCount,cm118:this.totalSlotsRequestedCount,cm119:r.reducedCount,cm120:r.extendedCount};this.core.get(L).fireEvent(Kr,u),this.batch=null,this.trackersSent+=1,this.trackersSent>=Zr&&(this.enabled=!1)}_getOrStartBatch(){return this.batch==null&&(this.batch={start:pe(),slots:Object.fromEntries(Object.values(et).map(e=>[e,[]])),targeting:{extendedCount:0,reducedCount:0}},setTimeout(()=>this._sendTracker(),Jr)),this.batch}};o(B,"ImplementationValidator"),l([b],B.prototype,"_initialize",1),l([h(A,"adRequestQueued")],B.prototype,"_onAdRequestQueued",1),l([h(A,"adRequestCompleted")],B.prototype,"_onAdRequestCompleted",1),l([h(O,"onSlotRequested")],B.prototype,"_onSlotRequested",1),l([h(O,"onSlotRequestValidated")],B.prototype,"_onSlotRequestValidated",1),B=l([p],B);s();a();s();a();var ne=class{_defineSlot(e,t={}){if(typeof e!="string"||t==null||typeof t!="object")return;let r={id:U(t.id),network:U(t.network),sizes:t.sizes!=null?xe(t.sizes):void 0,position:U(t.position)};this.core.get(R).createSlot("custom",0,e,r)}_adRendered(e,t){if(typeof e!="string"||t==null||typeof t!="object")return;let r=this.core.get(R).getSlot("custom",e);if(r==null)return;let i={type:"display",advertiserId:U(t.advertiserId),campaignId:U(t.campaignId),creativeId:U(t.creativeId),lineItemId:U(t.lineItemId),renderedSize:Je(t.renderedSize)};this.core.get(D).setAdRendered(r,i)}_getTargeting(e){let t=this.core.get(w);if(typeof e!="string")return t.getTargeting();let r=this.core.get(R).getSlot("custom",e);return t.getTargeting(r)}};o(ne,"CustomAdServer"),l([h(I,"defineSlot")],ne.prototype,"_defineSlot",1),l([h(I,"getTargeting")],ne.prototype,"_getTargeting",1),ne=l([p],ne);s();a();var ie=class{_initialize(){this._flushCommandBuffer()}_flushCommandBuffer(){return T(this,null,function*(){var u;yield Promise.resolve();let e=this.core.get(S).window(),t=(u=e.dvtag)!=null?u:{};e.dvtag=t,t.cmd instanceof Array||(t.cmd=[]);let r=t.cmd,i=r.length;t.cmd={push:o((...c)=>{for(let f of c)try{f()}catch(v){}return i+=c.length,i},"push")},t.cmd.push(...r)})}};o(ie,"CommandBuffer"),l([b],ie.prototype,"_initialize",1),l([Fe],ie.prototype,"_flushCommandBuffer",1),ie=l([p],ie);s();a();s();a();var en=Object.defineProperty,tn=Object.defineProperties,rn=Object.getOwnPropertyDescriptors,rr=Object.getOwnPropertySymbols,nn=Object.prototype.hasOwnProperty,on=Object.prototype.propertyIsEnumerable,nr=o((n,e,t)=>e in n?en(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,"__defNormalProp"),Be=o((n,e)=>{for(var t in e||(e={}))nn.call(e,t)&&nr(n,t,e[t]);if(rr)for(var t of rr(e))on.call(e,t)&&nr(n,t,e[t]);return n},"__spreadValues"),ir=o((n,e)=>tn(n,rn(e)),"__spreadProps");var Oe=(n=>(n.GAM="gam",n.XANDR="xandr",n.FREEWHEEL="freewheel",n.CUSTOM="custom",n))(Oe||{});var _t=(n=>(n[n.Disabled=0]="Disabled",n[n.Dryrun=1]="Dryrun",n))(_t||{});var ap=typeof TextDecoder=="function"?new TextDecoder:void 0,lp=typeof TextEncoder=="function"?new TextEncoder:void 0,sn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",an=Array.prototype.slice.call(sn),up=(n=>{let e={};return n.forEach((t,r)=>e[t]=r),e})(an),dp=String.fromCharCode.bind(String),cp=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):n=>new Uint8Array(Array.prototype.slice.call(n,0));var ln="__DVPUB_OT__",un=o(n=>ln+new URLSearchParams(n).toString().replace(/=/g,":").replace(/&/g,"|").replace(/\+/g,"%20").replace(/[^a-zA-Z0-9:|%_]/g,e=>`%${e.charCodeAt(0).toString(16)}`),"encodeParams"),or=o((n,e)=>Object.entries(e).reduce((r,[i,u])=>(r[`${n}${i}`]=u,r),{}),"prefixKeys"),dn=o(n=>{let e={};for(let[t,r]of Object.entries(n))e[t]=`${r}`;return e},"stringifyValues"),sr=o((n,e,t)=>{if(n==="custom"||n==="freewheel")return{};let r=dn(ir(Be({},e.passthroughParams),{dvp_uptpid:e.pageId,dvp_uptsid:e.slotId,dvp_uptsacnt:e.slotAdCount,dvp_qtpid:e.pageId})),i=un(Be(Be({},e.wrapperMode!=null?{m:String(e.wrapperMode)}:{}),or("_",r)));return n==="gam"?ir(Be(Be({dvpub_ot_params:i},e.wrapperMode!=null?{dv_upt_cwm:String(e.wrapperMode)}:{}),or("dv__",r)),{pts_pid:e.pageId,pts_sid:e.slotId}):n==="xandr"?{[t!=null?t:"pt1"]:i}:{}},"generateOmniTagTargeting");s();a();var ar=o(n=>{let e={};for(let[t,r]of Object.entries(n))r!=null&&(e[t]=typeof r=="string"?[r]:r);return e},"toTargeting");var cn={gpt:Oe.GAM,ast:Oe.XANDR,custom:Oe.CUSTOM,"legacy-api":Oe.CUSTOM},gn="pt9",W=class{constructor(){d(this,"plugins",{disableCreativeWrapperMeasurement:o(e=>[],"disableCreativeWrapperMeasurement")});d(this,"targetingSet",new E.Map);d(this,"targetingReliable",new E.Map)}_setCreativeWrapperTargeting(e){let t=e.uuid,r=this.core.get(P).getVisitUuid(),i=this.core.get(D).getNonEmptyAdRenderedCount(e),u=this.plugins.disableCreativeWrapperMeasurement(e).some(c=>c===!0)?_t.Disabled:void 0;this.core.get(w).setSlotTargeting(e,ar(sr(cn[e.adServer],{slotId:t,pageId:r,slotAdCount:i,wrapperMode:u},gn))),this.targetingSet.set(e,!0)}_onNewVisit(){let e=this.core.get(R).getSlots();for(let t of e)this._setCreativeWrapperTargeting(t)}_onAdRequested(e){this.targetingReliable.set(e,this.targetingSet.get(e)===!0)}isTargetingReliable(e){return this.targetingReliable.get(e)===!0}};o(W,"CreativeWrapperTargeting"),l([h(R,"slotDiscovered"),h(D,"adRendered")],W.prototype,"_setCreativeWrapperTargeting",1),l([h(P,"newVisit")],W.prototype,"_onNewVisit",1),l([h(D,"adRequested")],W.prototype,"_onAdRequested",1),W=l([p],W);s();a();var lr=10,oe=class{constructor(){d(this,"errors",new E.Map)}_getErrors(){return this.errors.summon(this.core.session,[])}toSafeCallback(e){return(...t)=>this._callSafely(e,t)}_callSafely(e,t){return e(...t)}_handleError(e,t){let r=this._getErrors(),i=t.join("=>");if(r.unshift(`${e}: ${i}`),r.length>lr){r.length=lr;return}this.core.get(L).fireEvent("log",{cd111:"error",cd112:e,cd113:i})}};o(oe,"ErrorHandler"),l([Fe],oe.prototype,"_callSafely",1),l([dt],oe.prototype,"_handleError",1),oe=l([p],oe);var Ne=class{};o(Ne,"HouseHold"),Ne=l([p,N(I),N(A),N(ie),N(L),N(oe),N(ne),N(H),N(W)],Ne);s();a();var mn=o(()=>{var n,e,t,r,i,u,c,f;if(((n=window.dvtag)==null?void 0:n._core)==null){try{let v={};for(let[y,C,de]of(t=(e=window.dvtag)==null?void 0:e._overrides)!=null?t:[])(r=v[y])!=null||(v[y]={}),(u=(i=v[y])[C])!=null||(i[C]=de);for(let y of ze)for(let[C,de]of Object.entries((c=v[y.name])!=null?c:{}))y.prototype[C]=de}catch(v){}window.dvtag=(f=window.dvtag)!=null?f:{},window.dvtag._core=new ke(ze),window.dvtag._core.execute()}},"main");try{mn()}catch(n){}})();
